/**
 * Arabic Book Library PWA - Main Application
 * SPA architecture with 4 views + reader
 * Depends on window.DB from db.js
 */

(function () {
  'use strict';

  // ==================== BOOK DATA ====================

  const BOOKS = [
    { id: '4hww', title: '\u0623\u0633\u0628\u0648\u0639 \u0627\u0644\u0639\u0645\u0644 4 \u0633\u0627\u0639\u0627\u062A', subtitle: 'The 4-Hour Workweek', author: '\u062A\u064A\u0645 \u0641\u064A\u0631\u064A\u0633', authorEn: 'Tim Ferriss', category: 'productivity', categoryAr: '\u0627\u0644\u0625\u0646\u062A\u0627\u062C\u064A\u0629 \u0648\u0627\u0644\u062A\u0648\u0627\u0632\u0646', path: '\u0627\u0644\u0625\u0646\u062A\u0627\u062C\u064A\u0629-\u0648\u0627\u0644\u062A\u0648\u0627\u0632\u0646/4-hour-workweek-summary.html', color: 'red', emoji: '\u23F0', chapters: 6 },
    { id: 'dw', title: '\u0627\u0644\u0639\u0645\u0644 \u0627\u0644\u0639\u0645\u064A\u0642', subtitle: 'Deep Work', author: '\u0643\u0627\u0644 \u0646\u064A\u0648\u0628\u0648\u0631\u062A', authorEn: 'Cal Newport', category: 'productivity', categoryAr: '\u0627\u0644\u0625\u0646\u062A\u0627\u062C\u064A\u0629 \u0648\u0627\u0644\u062A\u0648\u0627\u0632\u0646', path: '\u0627\u0644\u0625\u0646\u062A\u0627\u062C\u064A\u0629-\u0648\u0627\u0644\u062A\u0648\u0627\u0632\u0646/deep-work-summary.html', color: 'blue', emoji: '\uD83E\uDDE0', chapters: 8 },
    { id: 'dwz', title: '\u0645\u062A \u0628\u0635\u0641\u0631', subtitle: 'Die With Zero', author: '\u0628\u064A\u0644 \u0628\u064A\u0631\u0643\u0646\u0632', authorEn: 'Bill Perkins', category: 'productivity', categoryAr: '\u0627\u0644\u0625\u0646\u062A\u0627\u062C\u064A\u0629 \u0648\u0627\u0644\u062A\u0648\u0627\u0632\u0646', path: '\u0627\u0644\u0625\u0646\u062A\u0627\u062C\u064A\u0629-\u0648\u0627\u0644\u062A\u0648\u0627\u0632\u0646/die-with-zero-summary.html', color: 'orange', emoji: '\u231B', chapters: 9 },
    { id: 'ess', title: '\u0627\u0644\u062C\u0648\u0647\u0631\u064A\u0629', subtitle: 'Essentialism', author: '\u063A\u0631\u064A\u063A \u0645\u0627\u0643\u064A\u0648\u0646', authorEn: 'Greg McKeown', category: 'productivity', categoryAr: '\u0627\u0644\u0625\u0646\u062A\u0627\u062C\u064A\u0629 \u0648\u0627\u0644\u062A\u0648\u0627\u0632\u0646', path: '\u0627\u0644\u0625\u0646\u062A\u0627\u062C\u064A\u0629-\u0648\u0627\u0644\u062A\u0648\u0627\u0632\u0646/essentialism-summary.html', color: 'green', emoji: '\u2728', chapters: 8 },
    { id: 'rest', title: '\u0627\u0644\u0631\u0627\u062D\u0629', subtitle: 'Rest', author: '\u0623\u0644\u064A\u0643\u0633 \u0633\u0648\u0646\u063A-\u0643\u064A\u0645 \u0628\u0627\u0646\u063A', authorEn: 'Alex Soojung-Kim Pang', category: 'productivity', categoryAr: '\u0627\u0644\u0625\u0646\u062A\u0627\u062C\u064A\u0629 \u0648\u0627\u0644\u062A\u0648\u0627\u0632\u0646', path: '\u0627\u0644\u0625\u0646\u062A\u0627\u062C\u064A\u0629-\u0648\u0627\u0644\u062A\u0648\u0627\u0632\u0646/rest-book-summary.html', color: 'crimson', emoji: '\uD83C\uDF19', chapters: 12 },
    { id: 'pom', title: '\u0633\u064A\u0643\u0648\u0644\u0648\u062C\u064A\u0629 \u0627\u0644\u0645\u0627\u0644', subtitle: 'The Psychology of Money', author: '\u0645\u0648\u0631\u063A\u0627\u0646 \u0647\u0627\u0648\u0633\u0644', authorEn: 'Morgan Housel', category: 'finance', categoryAr: '\u0627\u0644\u0645\u0627\u0644 \u0648\u0627\u0644\u0627\u0633\u062A\u062B\u0645\u0627\u0631', path: '\u0627\u0644\u0645\u0627\u0644-\u0648\u0627\u0644\u0627\u0633\u062A\u062B\u0645\u0627\u0631/psychology-of-money-summary.html', color: 'purple', emoji: '\uD83D\uDCD6', chapters: 20 },
    { id: 'sj', title: '\u0633\u062A\u064A\u0641 \u062C\u0648\u0628\u0632', subtitle: 'Steve Jobs', author: '\u0648\u0627\u0644\u062A\u0631 \u0625\u064A\u0632\u0627\u0643\u0633\u0648\u0646', authorEn: 'Walter Isaacson', category: 'biography', categoryAr: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', path: '\u0627\u0644\u0633\u064A\u0631-\u0627\u0644\u0630\u0627\u062A\u064A\u0629/steve-jobs-summary.html', color: 'blue', emoji: '\uD83C\uDF4E', chapters: 8 },
    { id: 'em', title: '\u0625\u064A\u0644\u0648\u0646 \u0645\u0627\u0633\u0643', subtitle: 'Elon Musk', author: '\u0648\u0627\u0644\u062A\u0631 \u0625\u064A\u0632\u0627\u0643\u0633\u0648\u0646', authorEn: 'Walter Isaacson', category: 'biography', categoryAr: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', path: '\u0627\u0644\u0633\u064A\u0631-\u0627\u0644\u0630\u0627\u062A\u064A\u0629/elon-musk-summary.html', color: 'crimson', emoji: '\uD83D\uDE80', chapters: 8 },
    { id: 'ldv', title: '\u0644\u064A\u0648\u0646\u0627\u0631\u062F\u0648 \u062F\u0627\u0641\u0646\u0634\u064A', subtitle: 'Leonardo da Vinci', author: '\u0648\u0627\u0644\u062A\u0631 \u0625\u064A\u0632\u0627\u0643\u0633\u0648\u0646', authorEn: 'Walter Isaacson', category: 'biography', categoryAr: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', path: '\u0627\u0644\u0633\u064A\u0631-\u0627\u0644\u0630\u0627\u062A\u064A\u0629/leonardo-da-vinci-summary.html', color: 'amber', emoji: '\uD83C\uDFA8', chapters: 8 },
    { id: 'ein', title: '\u0623\u064A\u0646\u0634\u062A\u0627\u064A\u0646', subtitle: 'Einstein', author: '\u0648\u0627\u0644\u062A\u0631 \u0625\u064A\u0632\u0627\u0643\u0633\u0648\u0646', authorEn: 'Walter Isaacson', category: 'biography', categoryAr: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', path: '\u0627\u0644\u0633\u064A\u0631-\u0627\u0644\u0630\u0627\u062A\u064A\u0629/einstein-summary.html', color: 'teal', emoji: '\u269B\uFE0F', chapters: 8 },
    { id: 'bf', title: '\u0628\u0646\u062C\u0627\u0645\u064A\u0646 \u0641\u0631\u0627\u0646\u0643\u0644\u064A\u0646', subtitle: 'Benjamin Franklin', author: '\u0648\u0627\u0644\u062A\u0631 \u0625\u064A\u0632\u0627\u0643\u0633\u0648\u0646', authorEn: 'Walter Isaacson', category: 'biography', categoryAr: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', path: '\u0627\u0644\u0633\u064A\u0631-\u0627\u0644\u0630\u0627\u062A\u064A\u0629/benjamin-franklin-summary.html', color: 'navy', emoji: '\u26A1', chapters: 7 },
    { id: 'sd', title: '\u0634\u0648 \u062F\u0648\u062C', subtitle: 'Shoe Dog', author: '\u0641\u064A\u0644 \u0646\u0627\u064A\u062A', authorEn: 'Phil Knight', category: 'biography', categoryAr: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', path: '\u0627\u0644\u0633\u064A\u0631-\u0627\u0644\u0630\u0627\u062A\u064A\u0629/shoe-dog-summary.html', color: 'orange', emoji: '\uD83D\uDC5F', chapters: 8 },
    { id: 'rol', title: '\u0631\u062D\u0644\u0629 \u0627\u0644\u0639\u0645\u0631', subtitle: 'The Ride of a Lifetime', author: '\u0628\u0648\u0628 \u0625\u064A\u063A\u0631', authorEn: 'Bob Iger', category: 'biography', categoryAr: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', path: '\u0627\u0644\u0633\u064A\u0631-\u0627\u0644\u0630\u0627\u062A\u064A\u0629/ride-of-a-lifetime-summary.html', color: 'purple', emoji: '\uD83C\uDFF0', chapters: 8 },
    { id: 'titan', title: '\u062A\u0627\u064A\u062A\u0627\u0646', subtitle: 'Titan', author: '\u0631\u0648\u0646 \u0634\u064A\u0631\u0646\u0648', authorEn: 'Ron Chernow', category: 'biography', categoryAr: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', path: '\u0627\u0644\u0633\u064A\u0631-\u0627\u0644\u0630\u0627\u062A\u064A\u0629/titan-summary.html', color: 'red', emoji: '\uD83D\uDEE2\uFE0F', chapters: 8 },
    { id: 'wbba', title: '\u0639\u0646\u062F\u0645\u0627 \u064A\u0635\u0628\u062D \u0627\u0644\u0646\u064E\u0641\u064E\u0633 \u0647\u0648\u0627\u0621\u064B', subtitle: 'When Breath Becomes Air', author: '\u0628\u0648\u0644 \u0643\u0627\u0644\u0627\u0646\u064A\u062B\u064A', authorEn: 'Paul Kalanithi', category: 'biography', categoryAr: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', path: '\u0627\u0644\u0633\u064A\u0631-\u0627\u0644\u0630\u0627\u062A\u064A\u0629/when-breath-becomes-air-summary.html', color: 'cyan', emoji: '\uD83C\uDF2C\uFE0F', chapters: 7 },
    { id: 'gl', title: '\u0627\u0644\u0623\u0636\u0648\u0627\u0621 \u0627\u0644\u062E\u0636\u0631\u0627\u0621', subtitle: 'Greenlights', author: '\u0645\u0627\u062B\u064A\u0648 \u0645\u0627\u0643\u0648\u0646\u0647\u064A', authorEn: 'Matthew McConaughey', category: 'biography', categoryAr: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', path: '\u0627\u0644\u0633\u064A\u0631-\u0627\u0644\u0630\u0627\u062A\u064A\u0629/greenlights-summary.html', color: 'forest', emoji: '\uD83D\uDFE2', chapters: 7 },
    { id: 'cbs', title: '\u0623\u0639\u0631\u0641 \u0644\u0645\u0627\u0630\u0627 \u064A\u063A\u0631\u062F \u0627\u0644\u0637\u0627\u0626\u0631 \u0627\u0644\u062D\u0628\u064A\u0633', subtitle: 'I Know Why the Caged Bird Sings', author: '\u0645\u0627\u064A\u0627 \u0623\u0646\u062C\u064A\u0644\u0648', authorEn: 'Maya Angelou', category: 'biography', categoryAr: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', path: '\u0627\u0644\u0633\u064A\u0631-\u0627\u0644\u0630\u0627\u062A\u064A\u0629/caged-bird-sings-summary.html', color: 'pink', emoji: '\uD83D\uDC26', chapters: 7 },
    // Pregnancy Planning
    { id: 'tcyf', title: 'ุชุญููู ุจุฎุตูุจุชู', subtitle: 'Taking Charge of Your Fertility', author: 'ุชููู ููุดูุฑ', authorEn: 'Toni Weschler', category: 'pregnancy', categoryAr: 'ุชุฎุทูุท ุงูุญูู', path: 'ุชุฎุทูุท-ุงูุญูู/taking-charge-fertility-summary.html', color: 'pink', emoji: '๐ธ', chapters: 7 },
    { id: 'iswe', title: 'ูุจุฏุฃ ุจุงูุจููุถุฉ', subtitle: 'It Starts with the Egg', author: 'ุฑูุจููุง ููุช', authorEn: 'Rebecca Fett', category: 'pregnancy', categoryAr: 'ุชุฎุทูุท ุงูุญูู', path: 'ุชุฎุทูุท-ุงูุญูู/it-starts-with-egg-summary.html', color: 'purple', emoji: '๐ฅ', chapters: 7 },
    { id: 'af', title: 'ุฅููุงุธ ุงูุฎุตูุจุฉ', subtitle: 'Awakening Fertility', author: 'ูููุบ ุฃู', authorEn: 'Heng Ou', category: 'pregnancy', categoryAr: 'ุชุฎุทูุท ุงูุญูู', path: 'ุชุฎุทูุท-ุงูุญูู/awakening-fertility-summary.html', color: 'green', emoji: '๐ฟ', chapters: 7 },
    { id: 'iwg', title: 'ุฏููู ุงููุณุชุนุฌูุฉ ููุญูู', subtitle: "The Impatient Woman's Guide to Getting Pregnant", author: 'ุฌูู ุชููุฌ', authorEn: 'Jean M. Twenge', category: 'pregnancy', categoryAr: 'ุชุฎุทูุท ุงูุญูู', path: 'ุชุฎุทูุท-ุงูุญูู/impatient-woman-guide-summary.html', color: 'orange', emoji: 'โฑ๏ธ', chapters: 6 },
    { id: 'wbww', title: 'ุฃุฌุณุงุฏ ุงููุณุงุกุ ุญููุฉ ุงููุณุงุก', subtitle: "Women's Bodies, Women's Wisdom", author: 'ูุฑูุณุชูุงู ููุฑุซุฑูุจ', authorEn: 'Christiane Northrup', category: 'pregnancy', categoryAr: 'ุชุฎุทูุท ุงูุญูู', path: 'ุชุฎุทูุท-ุงูุญูู/womens-bodies-wisdom-summary.html', color: 'crimson', emoji: '๐ช', chapters: 7 },
    { id: 'tfd', title: 'ุญููุฉ ุงูุฎุตูุจุฉ', subtitle: 'The Fertility Diet', author: 'ุฎูุฑุฎู ุชุดุงูุงุฑู', authorEn: 'Jorge Chavarro', category: 'pregnancy', categoryAr: 'ุชุฎุทูุท ุงูุญูู', path: 'ุชุฎุทูุท-ุงูุญูู/fertility-diet-summary.html', color: 'teal', emoji: '๐ฅ', chapters: 6 },
    { id: 'ef', title: 'ุงูุฎุตูุจุฉ ุงูููููููุฉ', subtitle: 'Empowered Fertility', author: 'ูููุฑ ููู ูุฏูููุฑุง ููุจุฑูุงู', authorEn: 'Claire Hall & Devora Lieberman', category: 'pregnancy', categoryAr: 'ุชุฎุทูุท ุงูุญูู', path: 'ุชุฎุทูุท-ุงูุญูู/empowered-fertility-summary.html', color: 'blue', emoji: 'โจ', chapters: 7 },
    { id: 'tft', title: 'ุงููุตู ุงูุฑุงุจุน', subtitle: 'The Fourth Trimester', author: 'ูููุจุฑูู ุขู ุฌููุณูู', authorEn: 'Kimberly Ann Johnson', category: 'pregnancy', categoryAr: 'ุชุฎุทูุท ุงูุญูู', path: 'ุชุฎุทูุท-ุงูุญูู/fourth-trimester-summary.html', color: 'amber', emoji: '๐คฑ', chapters: 7 },
    { id: 'prm', title: 'ุฏููู ุฅุตูุงุญ ุงูุฏูุฑุฉ', subtitle: 'Period Repair Manual', author: 'ูุงุฑุง ุจุฑูุฏู', authorEn: 'Lara Briden', category: 'pregnancy', categoryAr: 'ุชุฎุทูุท ุงูุญูู', path: 'ุชุฎุทูุท-ุงูุญูู/period-repair-manual-summary.html', color: 'red', emoji: '๐ฌ', chapters: 7 },
    { id: 'cpg', title: 'ุฏููู ุงูุฃุฒูุงุฌ ููุญูู', subtitle: "The Couples' Pregnancy Guide", author: 'ุฏุฃูุชููู ูุงุฑุฏ ูุฑุงุดูู ูุงุฑุฏ', authorEn: "D'Anthony Ward & Rachel Ward", category: 'pregnancy', categoryAr: 'ุชุฎุทูุท ุงูุญูู', path: 'ุชุฎุทูุท-ุงูุญูู/couples-pregnancy-guide-summary.html', color: 'navy', emoji: '๐', chapters: 6 },
    // Fatherhood
    { id: 'tef', title: 'ุงูุฃุจ ุงูููุชุธุฑ', subtitle: 'The Expectant Father', author: 'ุฃุฑููู ุจุฑูุช ูุฌูููุฑ ุขุด ุฑูุฏูู', authorEn: 'Armin A. Brott & Jennifer Ash Rudick', category: 'fatherhood', categoryAr: 'ุงูุฃุจูุฉ', path: 'ุงูุฃุจูุฉ/expectant-father-summary.html', color: 'blue', emoji: '๐จโ๐ถ', chapters: 7 },
    { id: 'tnf', title: 'ุงูุฃุจ ุงูุฌุฏูุฏ', subtitle: 'The New Father', author: 'ุฃุฑููู ุจุฑูุช', authorEn: 'Armin A. Brott', category: 'fatherhood', categoryAr: 'ุงูุฃุจูุฉ', path: 'ุงูุฃุจูุฉ/new-father-summary.html', color: 'teal', emoji: '๐ถ', chapters: 7 },
    { id: 'tbp', title: 'ุดุฑูู ุงูููุงุฏุฉ', subtitle: 'The Birth Partner', author: 'ุจููู ุณููููู', authorEn: 'Penny Simkin', category: 'fatherhood', categoryAr: 'ุงูุฃุจูุฉ', path: 'ุงูุฃุจูุฉ/birth-partner-summary.html', color: 'crimson', emoji: '๐ค', chapters: 7 },
    { id: 'bp', title: 'ูู ูุณุชุนุฏุงู', subtitle: 'Be Prepared', author: 'ุบุงุฑู ุบุฑููุจุฑุบ', authorEn: 'Gary Greenberg', category: 'fatherhood', categoryAr: 'ุงูุฃุจูุฉ', path: 'ุงูุฃุจูุฉ/be-prepared-summary.html', color: 'orange', emoji: '๐', chapters: 6 },
    { id: 'ndsg', title: 'ุฏููู ูุฌุงุฉ ุงูุฃุจ ุงูุฌุฏูุฏ', subtitle: "The New Dad's Survival Guide", author: 'ุณููุช ูุงูุชุงููุด', authorEn: 'Scott Mactavish', category: 'fatherhood', categoryAr: 'ุงูุฃุจูุฉ', path: 'ุงูุฃุจูุฉ/new-dad-survival-summary.html', color: 'green', emoji: '๐ก๏ธ', chapters: 6 },
    { id: 'tde', title: 'ููุฒุฉ ุงูุฃุจ', subtitle: "The Dad's Edge", author: 'ูุงุฑู ูุงุบูุฑ', authorEn: 'Larry Hagner', category: 'fatherhood', categoryAr: 'ุงูุฃุจูุฉ', path: 'ุงูุฃุจูุฉ/dads-edge-summary.html', color: 'purple', emoji: '๐ช', chapters: 7 },
    { id: 'dad', title: 'ุฃุจ: ููู ุชููู ุงูุฃุจ ุงูุฐู ูุญุชุงุฌู ุฃุทูุงูู', subtitle: 'Dad', author: 'ูุฑูุบ ูููููุณูู', authorEn: 'Craig Wilkinson', category: 'fatherhood', categoryAr: 'ุงูุฃุจูุฉ', path: 'ุงูุฃุจูุฉ/dad-summary.html', color: 'navy', emoji: 'โค๏ธ', chapters: 7 },
    { id: 'sfsd', title: 'ุขุจุงุก ุฃูููุงุกุ ุจูุงุช ูููุงุช', subtitle: 'Strong Fathers, Strong Daughters', author: 'ููุบ ูููุฑ', authorEn: 'Meg Meeker', category: 'fatherhood', categoryAr: 'ุงูุฃุจูุฉ', path: 'ุงูุฃุจูุฉ/strong-fathers-daughters-summary.html', color: 'pink', emoji: '๐จโ๐ง', chapters: 7 },
    { id: 'bdss', title: 'ุขุจุงุก ุฃูุถูุ ุฃุจูุงุก ุฃููู', subtitle: 'Better Dads, Stronger Sons', author: 'ุฑูู ุฌููุณูู', authorEn: 'Rick Johnson', category: 'fatherhood', categoryAr: 'ุงูุฃุจูุฉ', path: 'ุงูุฃุจูุฉ/better-dads-sons-summary.html', color: 'amber', emoji: '๐จโ๐ฆ', chapters: 7 },
    { id: 'fhood', title: 'ุงูุฃุจูุฉ: ุงููุจูู ุจุงูุชุญุฏู ุงูุฃุนุธู', subtitle: 'Fatherhood', author: 'ุฅูุชุงู ุชููุงุณ', authorEn: 'Etan Thomas', category: 'fatherhood', categoryAr: 'ุงูุฃุจูุฉ', path: 'ุงูุฃุจูุฉ/fatherhood-summary.html', color: 'red', emoji: '๐', chapters: 7 },
    // Self-Management
    { id: 'ah', title: 'ุงูุนุงุฏุงุช ุงูุฐุฑูุฉ', subtitle: 'Atomic Habits', author: 'ุฌููุณ ูููุฑ', authorEn: 'James Clear', category: 'selfmgmt', categoryAr: 'ุฅุฏุงุฑุฉ ุงูุฐุงุช', path: 'ุฅุฏุงุฑุฉ-ุงูุฐุงุช/atomic-habits-summary.html', color: 'orange', emoji: 'โ๏ธ', chapters: 7 },
    { id: '7h', title: 'ุงูุนุงุฏุงุช ุงูุณุจุน ูููุงุณ ุงูุฃูุซุฑ ูุนุงููุฉ', subtitle: 'The 7 Habits of Highly Effective People', author: 'ุณุชููู ูููู', authorEn: 'Stephen R. Covey', category: 'selfmgmt', categoryAr: 'ุฅุฏุงุฑุฉ ุงูุฐุงุช', path: 'ุฅุฏุงุฑุฉ-ุงูุฐุงุช/seven-habits-summary.html', color: 'blue', emoji: '๐', chapters: 7 },
    { id: 'tce', title: 'ุงูุชุฃุซูุฑ ุงููุฑููุจ', subtitle: 'The Compound Effect', author: 'ุฏุงุฑูู ูุงุฑุฏู', authorEn: 'Darren Hardy', category: 'selfmgmt', categoryAr: 'ุฅุฏุงุฑุฉ ุงูุฐุงุช', path: 'ุฅุฏุงุฑุฉ-ุงูุฐุงุช/compound-effect-summary.html', color: 'green', emoji: '๐', chapters: 6 },
    { id: 'ne', title: 'ูุง ุฃุนุฐุงุฑ! ููุฉ ุงูุงูุถุจุงุท ุงูุฐุงุชู', subtitle: 'No Excuses! The Power of Self-Discipline', author: 'ุจุฑุงูู ุชุฑูุณู', authorEn: 'Brian Tracy', category: 'selfmgmt', categoryAr: 'ุฅุฏุงุฑุฉ ุงูุฐุงุช', path: 'ุฅุฏุงุฑุฉ-ุงูุฐุงุช/no-excuses-summary.html', color: 'red', emoji: '๐ซ', chapters: 7 },
    { id: 'did', title: 'ุงูุงูุถุจุงุท ูู ุงููุฏุฑ', subtitle: 'Discipline Is Destiny', author: 'ุฑุงูุงู ููููุฏุงู', authorEn: 'Ryan Holiday', category: 'selfmgmt', categoryAr: 'ุฅุฏุงุฑุฉ ุงูุฐุงุช', path: 'ุฅุฏุงุฑุฉ-ุงูุฐุงุช/discipline-destiny-summary.html', color: 'amber', emoji: 'โ๏ธ', chapters: 7 },
    { id: 'tmiy', title: 'ุงูุฌุจู ูู ุฃูุช', subtitle: 'The Mountain Is You', author: 'ุจุฑูุงูุง ููุณุช', authorEn: 'Brianna Wiest', category: 'selfmgmt', categoryAr: 'ุฅุฏุงุฑุฉ ุงูุฐุงุช', path: 'ุฅุฏุงุฑุฉ-ุงูุฐุงุช/mountain-is-you-summary.html', color: 'teal', emoji: '๐๏ธ', chapters: 7 },
    { id: 'sdb', title: 'ูุฎุทุท ุงูุงูุถุจุงุท ุงูุฐุงุชู', subtitle: 'The Self-Discipline Blueprint', author: 'ุจุงุชุฑูู ุฅุฏุจูุงุฏ', authorEn: 'Patrik Edblad', category: 'selfmgmt', categoryAr: 'ุฅุฏุงุฑุฉ ุงูุฐุงุช', path: 'ุฅุฏุงุฑุฉ-ุงูุฐุงุช/self-discipline-blueprint-summary.html', color: 'crimson', emoji: '๐', chapters: 6 },
    { id: '15c', title: 'ุงูุงูุชุฒุงูุงุช ุงูุฎูุณุฉ ุนุดุฑ ููููุงุฏุฉ ุงููุงุนูุฉ', subtitle: 'The 15 Commitments of Conscious Leadership', author: 'ุฌูู ุฏูุซูุฑ ูุฏูุงูุง ุชุดุงุจูุงู', authorEn: 'Jim Dethmer & Diana Chapman', category: 'selfmgmt', categoryAr: 'ุฅุฏุงุฑุฉ ุงูุฐุงุช', path: 'ุฅุฏุงุฑุฉ-ุงูุฐุงุช/fifteen-commitments-summary.html', color: 'navy', emoji: '๐ฏ', chapters: 7 },
    { id: 'lwnt', title: 'ุงููุงุฆุฏ ุงูุฐู ุจูุง ููุตุจ', subtitle: 'The Leader Who Had No Title', author: 'ุฑูุจู ุดุงุฑูุง', authorEn: 'Robin Sharma', category: 'selfmgmt', categoryAr: 'ุฅุฏุงุฑุฉ ุงูุฐุงุช', path: 'ุฅุฏุงุฑุฉ-ุงูุฐุงุช/leader-no-title-summary.html', color: 'pink', emoji: '๐', chapters: 7 },
    // Marriage
    { id: '7pm', title: 'ุงููุจุงุฏุฆ ุงูุณุจุนุฉ ููุฌุงุญ ุงูุฒูุงุฌ', subtitle: 'The Seven Principles for Making Marriage Work', author: 'ุฌูู ุบูุชูุงู', authorEn: 'John M. Gottman', category: 'marriage', categoryAr: 'ุงูุญูุงุฉ ุงูุฒูุฌูุฉ', path: 'ุงูุญูุงุฉ-ุงูุฒูุฌูุฉ/seven-principles-marriage-summary.html', color: 'blue', emoji: '๐', chapters: 7 },
    { id: 'hmt', title: 'ุงุญุถูู ุจููุฉ', subtitle: 'Hold Me Tight', author: 'ุณู ุฌููุณูู', authorEn: 'Sue Johnson', category: 'marriage', categoryAr: 'ุงูุญูุงุฉ ุงูุฒูุฌูุฉ', path: 'ุงูุญูุงุฉ-ุงูุฒูุฌูุฉ/hold-me-tight-summary.html', color: 'crimson', emoji: '๐ค', chapters: 7 },
    { id: 'wfl', title: 'ูุจุฑูุฌูู ููุญุจ', subtitle: 'Wired for Love', author: 'ุณุชุงู ุชุงุชููู', authorEn: 'Stan Tatkin', category: 'marriage', categoryAr: 'ุงูุญูุงุฉ ุงูุฒูุฌูุฉ', path: 'ุงูุญูุงุฉ-ุงูุฒูุฌูุฉ/wired-for-love-summary.html', color: 'purple', emoji: '๐ง', chapters: 7 },
    { id: 'gtlyw', title: 'ุงูุญุตูู ุนูู ุงูุญุจ ุงูุฐู ุชุฑูุฏู', subtitle: 'Getting the Love You Want', author: 'ูุงุฑููู ููุฏุฑููุณ', authorEn: 'Harville Hendrix', category: 'marriage', categoryAr: 'ุงูุญูุงุฉ ุงูุฒูุฌูุฉ', path: 'ุงูุญูุงุฉ-ุงูุฒูุฌูุฉ/getting-love-you-want-summary.html', color: 'green', emoji: '๐', chapters: 7 },
    { id: '5ll', title: 'ูุบุงุช ุงูุญุจ ุงูุฎูุณ', subtitle: 'The Five Love Languages', author: 'ุบุงุฑู ุชุดุงุจูุงู', authorEn: 'Gary Chapman', category: 'marriage', categoryAr: 'ุงูุญูุงุฉ ุงูุฒูุฌูุฉ', path: 'ุงูุญูุงุฉ-ุงูุฒูุฌูุฉ/five-love-languages-summary.html', color: 'pink', emoji: '๐', chapters: 7 },
    { id: 'nvc', title: 'ุงูุชูุงุตู ุงููุงุนููู', subtitle: 'Nonviolent Communication', author: 'ูุงุฑุดุงู ุฑูุฒูุจุฑุบ', authorEn: 'Marshall Rosenberg', category: 'marriage', categoryAr: 'ุงูุญูุงุฉ ุงูุฒูุฌูุฉ', path: 'ุงูุญูุงุฉ-ุงูุฒูุฌูุฉ/nonviolent-communication-summary.html', color: 'teal', emoji: '๐๏ธ', chapters: 7 },
    { id: '8d', title: 'ุซูุงููุฉ ููุงุนูุฏ', subtitle: 'Eight Dates', author: 'ุฌูู ูุฌููู ุบูุชูุงู', authorEn: 'John & Julie Gottman', category: 'marriage', categoryAr: 'ุงูุญูุงุฉ ุงูุฒูุฌูุฉ', path: 'ุงูุญูุงุฉ-ุงูุฒูุฌูุฉ/eight-dates-summary.html', color: 'amber', emoji: '๐๏ธ', chapters: 8 },
    { id: 'sm', title: 'ุงูุฒูุงุฌ ุงูููุฏุณ', subtitle: 'Sacred Marriage', author: 'ุบุงุฑู ุชููุงุณ', authorEn: 'Gary Thomas', category: 'marriage', categoryAr: 'ุงูุญูุงุฉ ุงูุฒูุฌูุฉ', path: 'ุงูุญูุงุฉ-ุงูุฒูุฌูุฉ/sacred-marriage-summary.html', color: 'navy', emoji: '๐', chapters: 7 },
    { id: 'pasm', title: 'ุงูุฒูุงุฌ ุงูุนุงุทูู', subtitle: 'Passionate Marriage', author: 'ุฏูููุฏ ุดูุงุฑุด', authorEn: 'David Schnarch', category: 'marriage', categoryAr: 'ุงูุญูุงุฉ ุงูุฒูุฌูุฉ', path: 'ุงูุญูุงุฉ-ุงูุฒูุฌูุฉ/passionate-marriage-summary.html', color: 'red', emoji: '๐ฅ', chapters: 7 },
    { id: 'db', title: 'ุฅููุงุฐ ุงูุฒูุงุฌ', subtitle: 'Divorce Busting', author: 'ููุดูู ูุงููุฑ-ุฏูููุณ', authorEn: 'Michele Weiner-Davis', category: 'marriage', categoryAr: 'ุงูุญูุงุฉ ุงูุฒูุฌูุฉ', path: 'ุงูุญูุงุฉ-ุงูุฒูุฌูุฉ/divorce-busting-summary.html', color: 'orange', emoji: '๐', chapters: 6 },
  ];

  // Category metadata
  const CATEGORIES = [
    { id: 'productivity', ar: '\u0627\u0644\u0625\u0646\u062A\u0627\u062C\u064A\u0629 \u0648\u0627\u0644\u062A\u0648\u0627\u0632\u0646', icon: '\u26A1' },
    { id: 'finance', ar: '\u0627\u0644\u0645\u0627\u0644 \u0648\u0627\u0644\u0627\u0633\u062A\u062B\u0645\u0627\u0631', icon: '\uD83D\uDCB0' },
    { id: 'biography', ar: '\u0627\u0644\u0633\u064A\u0631 \u0627\u0644\u0630\u0627\u062A\u064A\u0629', icon: '\uD83D\uDC64' },
    { id: 'pregnancy', ar: 'ุชุฎุทูุท ุงูุญูู', icon: '๐คฐ' },
    { id: 'fatherhood', ar: 'ุงูุฃุจูุฉ', icon: '๐จโ๐งโ๐ฆ' },
    { id: 'selfmgmt', ar: 'ุฅุฏุงุฑุฉ ุงูุฐุงุช', icon: '๐งญ' },
    { id: 'marriage', ar: 'ุงูุญูุงุฉ ุงูุฒูุฌูุฉ', icon: '๐' },
  ];

  // ==================== BOOK ACTIONS ====================

  const BOOK_ACTIONS = {
    '4hww': [
      'ุญุฏุฏ 3 ููุงู ุฃุณุงุณูุฉ ูู ููู ูุฑูุฒ ุนูููุง ููุท',
      'ุทุจู ูุงุนุฏุฉ 80/20: ุญุฏุฏ ุงูู20% ูู ุนููู ุงููู ูุฌูุจ 80% ูู ุงููุชุงุฆุฌ',
      'ุฌุฑุจ ุชูููุถ ูููุฉ ูุงุญุฏุฉ ูุงูุฃุณุจูุน ูุดุฎุต ุซุงูู ุฃู ุฎุฏูุฉ',
      'ุญุฏุฏ ุฃููุงุช ูุญุฏุฏุฉ ูุชุดูู ุงูุฅูููู ุจุฏู ูุง ุชุดููู ูู ุดูู',
      'ุงุนูู "ุชุฌุฑุจุฉ ูุตุบุฑุฉ" ููุดุฑูุน ุฌุงูุจู ูุฏุฎูู ุฏุฎู ุฅุถุงูู',
      'ุฎุทุท ูุฅุฌุงุฒุฉ ูุตูุฑุฉ ูุดูู ููู ุดุบูู ููุดู ุจุฏููู',
    ],
    'dw': [
      'ุฎุตุต ุณุงุนุชูู ููููุงู ููุนูู ุงูุนููู ุจุฏูู ุฃู ูุดุชุชุงุช',
      'ุฃุบูู ุงูุฅุดุนุงุฑุงุช ูุงูุณูุดู ููุฏูุง ููุช ุงูุชุฑููุฒ',
      'ุญุฏุฏ ููุงู ุซุงุจุช ููุนูู ุงูุนููู ูุฎููู ุจูุฆุฉ ุฎุงููุฉ ูู ุงููุดุชุชุงุช',
      'ุทุจู "ุทููุณ ุงูุจุฏุงูุฉ": ูููุฉุ ููุณููู ูุญุฏุฏุฉุ ุฃู ุชูุฑูู ูุจู ุงูุนูู ุงูุนููู',
      'ุชุชุจุน ุณุงุนุงุช ุงูุนูู ุงูุนููู ููููุงู ูุงูุชุจูุง ูู ุฏูุชุฑ',
      'ูู "ูุง" ูุงุฌุชูุงุน ูุงุญุฏ ุบูุฑ ุถุฑูุฑู ูุงูุฃุณุจูุน',
    ],
    'dwz': [
      'ุงูุชุจ ูุงุฆูุฉ ุจู10 ุชุฌุงุฑุจ ุชุจู ุชุนูุดูุง ูุจู ุนูุฑ ุงูู50',
      'ุงุญุณุจ "ุนุงุฆุฏ ุงูุฐูุฑูุงุช" ูุชุฌุฑุจุฉ ุชููุฑ ูููุง ููุงุจู ุชูููุชูุง',
      'ุงุนุทู ูุฏูุฉ ุฃู ุณุงุนุฏ ุดุฎุต ูุฑูุจ ุงูุญูู ุจุฏู ูุง ุชูุชุธุฑ',
      'ุฎุทุท ูุชุฌุฑุจุฉ ุฌุฏูุฏุฉ ูุงูุดูุฑ ูุน ุนุงุฆูุชู ุฃู ุฃุตุฏูุงุฆู',
      'ุฑุงุฌุน ูุตุงุฑููู ูุญูู ุฌุฒุก ูู ุงูุงุฏุฎุงุฑ ุงูููุฑุท ูุชุฌุงุฑุจ ุญููููุฉ',
      'ุงูุชุจ "ุฎุทุฉ ุญูุงุฉ" ุจุงูุนููุฏ: ูุด ุชุจู ุชุญูู ูู 10 ุณููุงุช',
    ],
    'ess': [
      'ุงูุชุจ ูุงุฆูุฉ ุจูู ุงูุชุฒุงูุงุชู ูุดุทุจ 3 ุฃุดูุงุก ุบูุฑ ุถุฑูุฑูุฉ',
      'ุชุนูู ุชููู "ูุง" ุจูุทู: ุฌุฑุจ ุฑูุถ ุทูุจ ูุงุญุฏ ูุงูุฃุณุจูุน',
      'ุญุฏุฏ ุงูุดูุก ุงููุงุญุฏ ุงูุฃูู ุนูุฏู ูู ุงูุญูุงุฉ ุงูุญูู',
      'ูุธู ููุชุจู ุฃู ุบุฑูุชู: ุชุฎูุต ูู 10 ุฃุดูุงุก ูุง ุชุญุชุงุฌูุง',
      'ุฎุตุต ููุช "ูุฑุงุบ ูุฎุทุท" ุฃุณุจูุนูุงู ููุชูููุฑ ูุงูุชุฃูู',
      'ูุจู ูุง ุชูุจู ุฃู ุงูุชุฒุงู ุฌุฏูุฏุ ุงุณุฃู: "ูู ูุฐุง ุถุฑูุฑู ูุนูุงูุ"',
    ],
    'rest': [
      'ุฎุฐ ูููููุฉ 20 ุฏูููุฉ ููููุงู ุจุนุฏ ุงูุธูุฑ',
      'ูุงุฑุณ ููุงูุฉ ุฅุจุฏุงุนูุฉ ูุง ุนูุงูุฉ ููุง ุจุดุบูู (ุฑุณูุ ููุณูููุ ุทุจุฎ)',
      'ุงูุดู 30 ุฏูููุฉ ููููุงู ูู ุงูุทุจูุนุฉ ุจุฏูู ุฌูุงู',
      'ุญุฏุฏ ููุช ููุงูุฉ ุซุงุจุช ูุดุบูู ูู ููู ูุงูุชุฒู ููู',
      'ุฎุตุต ููู ุฑุงุญุฉ ูุงูู ูู ุงูุฃุณุจูุน ุจุฏูู ุฃู ุดุบู',
      'ุฌุฑุจ ุงูุชุฃูู ุฃู ุชูุงุฑูู ุงูุชููุณ 10 ุฏูุงุฆู ูู ุตุจุงุญ',
    ],
    'pom': [
      'ุงุจุฏุฃ ุจุงุฏุฎุงุฑ 10% ูู ุฏุฎูู ุงูุดูุฑู ุจุดูู ุชููุงุฆู',
      'ุงูุชุจ "ูุตุชู ุงููุงููุฉ": ููู ุฃุซุฑุช ุชุฑุจูุชู ุนูู ุนูุงูุชู ุจุงููููุณ',
      'ูุง ุชูุงุฑู ููุณู ุจุบูุฑู ูุงููุงู - ุญุฏุฏ ุฃูุฏุงูู ุงูุฎุงุตุฉ',
      'ุงุจุฏุฃ ูู ุงุณุชุซูุงุฑ ุจุณูุท (ุตูุฏูู ูุคุดุฑุงุช) ููู ุจูุจูุบ ุตุบูุฑ',
      'ุงุนูู "ุตูุฏูู ุทูุงุฑุฆ" ููููู 6 ุดููุฑ ูู ุงููุตุงุฑูู',
      'ุงูุฑุฃ ุนู ููููู "ุงููุงุฆุฏุฉ ุงููุฑูุจุฉ" ูุทุจูู ุนูู ุงุณุชุซูุงุฑุงุชู',
    ],
    'sj': [
      'ุฌุฑุจ ุฑุจุท ูุฌุงููู ูุฎุชูููู ูู ุงูุชูุงูุงุชู ูู ูุดุฑูุน ูุงุญุฏ',
      'ุงุดุชุบู ุนูู ุชุจุณูุท ุดูุก ูุนูุฏ ูู ุญูุงุชู ุฃู ุดุบูู',
      'ุงุทูุจ ุฑุฃู ุตุฑูุญ ูู 3 ุฃุดุฎุงุต ุชุซู ูููู ุนู ุฃุฏุงุฆู',
      'ุตูู ุฃู ุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ูููุชุฌ ุฃู ุฎุฏูุฉ ุชูุฏููุง',
      'ุงุฑุฌุน ููุดุฑูุน ูุงุดู ูุฏูู ูุดููู ุจูุธุฑุฉ ุฌุฏูุฏุฉ',
      'ุฑูุฒ ุนูู ุงูุฌูุฏุฉ ูู ุงููููุฉ: ุฃููู ูุดุฑูุน ูุงุญุฏ ุจุงุญุชุฑุงููุฉ',
    ],
    'em': [
      'ุญุฏุฏ ูุดููุฉ ูุจูุฑุฉ ุชููู ูููุฑ ูู ุญู ูู ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ',
      'ุชุนูู ููุงุฑุฉ ุชูููุฉ ุฌุฏูุฏุฉ ุฎุงุฑุฌ ุชุฎุตุตู (ุจุฑูุฌุฉุ ุชุตูููุ ููุฏุณุฉ)',
      'ุญุฏุฏ ูุฏู ุทููุญ ุฌุฏุงู ูู5 ุณููุงุช ูุฏุงู ูุงูุชุจ ุฎุทูุงุช ุชุญูููู',
      'ุงุณุฃู ููุณู: "ุฅูุด ุงูุฃุณูุฃ ุงููู ูููู ูุตูุฑุ" ูุจู ูุง ุชุฎุงู ูู ุงููุฎุงุทุฑุฉ',
      'ุงูุฑุฃ ุนู ูุฌุงู ุนููู ุฌุฏูุฏ ูู ุดูุฑ (ููุฒูุงุกุ ูููุ ุฐูุงุก ุงุตุทูุงุนู)',
      'ุทุจู "ุงูุชูููุฑ ูู ุงููุจุงุฏุฆ ุงูุฃููู" ุนูู ูุดููุฉ ุชูุงุฌูู ุญุงููุงู',
    ],
    'ldv': [
      'ุงุญูู ุฏูุชุฑ ุตุบูุฑ ูุณุฌู ูู ููุฑุฉ ุฃู ููุงุญุธุฉ ุชูุฑ ุนููู',
      'ุงุฑุณู ุดูุก ุชุดููู ููููุงู ุญุชู ูู ูุง ููุช ููุงู',
      'ุงุณุฃู "ููุดุ" 5 ูุฑุงุช ุนู ุดูุก ุนุงุฏู ุชุดููู ูู ููู',
      'ุงุฏุฑุณ ูุฌุงู ูุฎุชูู ุชูุงูุงู ุนู ุชุฎุตุตู ููุฏุฉ ุดูุฑ',
      'ูุงุญุธ ุชูุงุตูู ุงูุทุจูุนุฉ: ุงูุธูุ ุงูุถูุกุ ุญุฑูุฉ ุงููุงุก',
      'ุงุฌูุน ุจูู ุงูุนูู ูุงููู: ุฌุฑุจ ูุดุฑูุน ูุฏูุฌ ุงูุงุซููู',
    ],
    'ein': [
      'ุฎุตุต ููุช ููุชุฎูู ูุงูุชูููุฑ ุงูุญุฑ ุจุฏูู ูููุฏ',
      'ุชุญุฏู ูุฑุถูุฉ ูุงุญุฏุฉ ุชุคูู ูููุง ูุงุณุฃู: "ูุงุฐุง ูู ููุช ุบูุทุงูุ"',
      'ุจุณูุท ููุฑุฉ ูุนูุฏุฉ ุญุชู ูููููุง ุทูู ุนูุฑู 10 ุณููุงุช',
      'ูุงุฑุณ ููุงูุฉ ููุณูููุฉ (ุงูุนุฒู ูุญูุฒ ุงูุชูููุฑ ุงูุฅุจุฏุงุนู)',
      'ุงูุถู ููุช ุจููุฑุฏู ููุชุฃูู ุงูุนููู ุจุฏูู ุฃู ุชุดุชูุช',
      'ูุงูุด ุฃููุงุฑู ูุน ุดุฎุต ูุฎุชูู ูุนู ูู ุงูุฑุฃู',
    ],
    'bf': [
      'ุงุฎุชุฑ 3 ูุถุงุฆู ูู ูุงุฆูุฉ ูุฑุงููููู ูุงุดุชุบู ุนูููุง ูุงูุฃุณุจูุน',
      'ุงูุฑุฃ 30 ุฏูููุฉ ููููุงู ูู ูุฌุงู ุฌุฏูุฏ ูุง ุชุนุฑูู',
      'ุงุจุฏุฃ ูุดุฑูุน ุฎุฏูุฉ ูุฌุชูุนูุฉ ุตุบูุฑ ูู ุญูู',
      'ุงูุชุจ ุฌุฏูู ูููู ุจุงูุชูุตูู ููููู ุฅูุชุงุฌูุชู ูู ูุณุงุก',
      'ุชุนูู ููุงุฑุฉ ุนูููุฉ ุฌุฏูุฏุฉ (ูุฌุงุฑุฉุ ููุฑุจุงุกุ ุจุฑูุฌุฉ)',
      'ูููุฑ ุฌุฒุก ูู ุฏุฎูู ูุงุณุชุซูุฑู ุจุญููุฉ ูู ูุดุฑูุน ุตุบูุฑ',
    ],
    'sd': [
      'ุงุจุฏุฃ ูุดุฑูุนู ุงูุฌุงูุจู ุญุชู ูู ูุง ููุช ูุณุชุนุฏ 100%',
      'ุงุทูุจ ูุตูุญุฉ ูู ุดุฎุต ูุงุฌุญ ูู ูุฌุงูู',
      'ุชูุจู ุงููุดู ูุฌุฒุก ูู ุงูุฑุญูุฉ ูุงูุชุจ 3 ุฏุฑูุณ ุชุนููุชูุง ูู ูุดู ุณุงุจู',
      'ุงุจูู ุนูุงูุฉ ูุน ุดุฑูู ุฃู ูุฑูู ูููู ููุงุท ุถุนูู',
      'ุฑูุถ ุฃู ูุงุฑุณ ุฑูุงุถุฉ ุชุญุจูุง - ุงูุฌุณู ุงูุณููู ูุฏุนู ุงูุนูู',
      'ูุง ุชุณุชุณูู ุนูุฏ ุฃูู ุนูุจุฉ: ุงุฑุฌุน ุญุงูู ุจุทุฑููุฉ ูุฎุชููุฉ',
    ],
    'rol': [
      'ุชุนูู ุงูุฅูุตุงุช ุงูุญูููู: ุงุณุชูุน ูุดุฎุต ุจุฏูู ูุง ุชูุงุทุนู',
      'ุงุชุฎุฐ ูุฑุงุฑ ูุงุญุฏ ุฌุฑูุก ููุช ุชุฃุฌูู ูู ุฒูุงู',
      'ูู ูุชูุงุฆู ุจููุฉ: ุงุจุฏุฃ ูู ููู ุจุฐูุฑ 3 ุฃุดูุงุก ุฅูุฌุงุจูุฉ',
      'ุงุฏุฑุณ ุงูููุงูุณูู ูู ูุฌุงูู ูุญุฏุฏ ูุฑุตุฉ ููุชููุฒ',
      'ุงุณุชุซูุฑ ูู ุชุทููุฑ ูุฑููู ุฃู ูู ุญููู',
      'ุงุนุชุฑู ุจุฎุทุฃ ูุงุญุฏ ุงุฑุชูุจุชู ูุตูุญู ุจุณุฑุนุฉ',
    ],
    'titan': [
      'ุทุจู ุงูุงูุถุจุงุท ุงููุงูู: ุชุชุจุน ูู ุฑูุงู ุชุตุฑูู ููุฏุฉ ุดูุฑ',
      'ุงุจุญุซ ุนู ูุฑุตุฉ ุงุณุชุซูุงุฑูุฉ ูุชุฌุงูููุง ุงูุฌููุน',
      'ุงุจูู ุณูุนุฉ ูููุฉ: ุฎู ูููุชู ุชููู ูุนุฏู',
      'ููุฑ ุนูู ุงููุฏู ุงูุทููู: ุฎุทุท ูู10-20 ุณูุฉ ูุฏุงู',
      'ุชุจุฑุน ุฃู ุณุงูู ูู ุนูู ุฎูุฑู ููุชุธู',
      'ุชุนูู ูู ุฃุฎุทุงุก ุบูุฑู: ุงูุฑุฃ ุนู ูุดู ุฑุฌุงู ุฃุนูุงู ูุดููุฑูู',
    ],
    'wbba': [
      'ุงูุชุจ ุฑุณุงูุฉ ูุดุฎุต ุชุญุจู ุชุนุจุฑ ูููุง ุนู ุชูุฏูุฑู',
      'ุญุฏุฏ ูููู ุงูุฃุณุงุณูุฉ: ูุง ุงูุฃุดูุงุก ุงููู ุชุนุทู ุญูุงุชู ูุนููุ',
      'ุงูุถู ููุช ููุนู ูุน ุนุงุฆูุชู ุจุฏูู ุฌูุงูุงุช ุฃู ุชุดุชูุช',
      'ุงุจุฏุฃ ูุดุฑูุน ุฅุฑุซ: ุดูุก ูุจูู ุจุนุฏู (ูุชุงุจุ ูุดุฑูุนุ ุชุนููู)',
      'ุณุงูุญ ุดุฎุต ููุช ุฒุนูุงู ููู - ุงูุญูุงุฉ ูุตูุฑุฉ',
      'ุนูุด ุงููุญุธุฉ ุงูุญุงููุฉ: ูุงุฑุณ ุงูุงูุชูุงู ููููุงู',
    ],
    'gl': [
      'ุงูุชุจ ููููุงุชู: ุณุฌู ุฃููุงุฑู ูุชุฌุงุฑุจู ูู ููู',
      'ุณุงูุฑ ูููุงู ุฌุฏูุฏ ุชูุงูุงู ูุง ุฒุฑุชู ูุจู',
      'ุงุฎุฑุฌ ูู ููุทูุฉ ุงูุฑุงุญุฉ: ุฌุฑุจ ุดูุก ูุฎููู ูุงูุฃุณุจูุน',
      'ุญูู "ุงูุถูุก ุงูุฃุญูุฑ" ูู ุญูุงุชู ููุฑุตุฉ ุชุนูู',
      'ูู ุตุงุฏู ูุน ููุณู: ูุด ุชุจู ูุนูุงู ูู ูุด ูุจูู ููู',
      'ุงุถุญู ุฃูุซุฑ: ุดูู ูููู ููููุฏู ุฃู ุงูุถู ููุช ูุน ูุงุณ ูุฑุญูู',
    ],
    'cbs': [
      'ุงูุฑุฃ ุฃุฏุจ ูู ุซูุงูุฉ ูุฎุชููุฉ ุนู ุซูุงูุชู ูู ุดูุฑ',
      'ุฏุงูุน ุนู ุดุฎุต ูุชุนุฑุถ ููุธูู ุญุชู ูู ุจุณูุท',
      'ุงูุชุจ ูุตุฉ ูู ุทูููุชู ูุดูู ููู ุดููุชู',
      'ุชุนูู ูู ุชุฌุงุฑุจ ุงูุขุฎุฑูู: ุงุณุชูุน ููุตุฉ ุญูุงุฉ ุดุฎุต ูุฎุชูู ุนูู',
      'ุนุจูุฑ ุนู ูุดุงุนุฑู ุจุงููุชุงุจุฉ (ูุตุฉุ ุดุนุฑุ ููููุงุช)',
      'ูุงูู ุงูุธูู ุจุงูุชุนููู: ุนููู ุดุฎุต ููุงุฑุฉ ูุฌุงูุงู',
    ],
    // Pregnancy Planning
    'tcyf': [
      'ุงุจุฏุฆู ุจุชุชุจุน ุฏูุฑุชู ุงูุดูุฑูุฉ ููุฏุฉ 3 ุดููุฑ ุนูู ุงูุฃูู',
      'ููุณู ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุฌุณูู ุงูุฃุณุงุณูุฉ ูู ุตุจุงุญ ูุจู ูุง ุชูููู',
      'ุฑุงูุจู ุนูุงูุงุช ุงูุชุจููุถ: ุงูุฅูุฑุงุฒุงุช ูุฃูู ุงูุจุทู',
      'ุณุฌูู ููุงุญุธุงุชู ุงูููููุฉ ูู ุชุทุจูู ุฃู ุฏูุชุฑ ุฎุงุต',
      'ุญุฏุฏู ูุงูุฐุฉ ุงูุฎุตูุจุฉ ุงูุฎุงุตุฉ ููู ุจูุงุกู ุนูู ุจูุงูุงุชู',
      'ุดุงุฑูู ุงููุชุงุฆุฌ ูุน ุดุฑููู ุนุดุงู ุชุฎุทุทูู ุณูุง',
    ],
    'iswe': [
      'ุชุฎูุตู ูู ุงูููุชุฌุงุช ุงูุจูุงุณุชูููุฉ ุงููู ูููุง BPA ูู ูุทุจุฎู',
      'ุงุจุฏุฆู ุจุฃุฎุฐ ูููู CoQ10 ุจุนุฏ ุงุณุชุดุงุฑุฉ ุทุจูุจู',
      'ุบููุฑู ููุชุฌุงุช ุงูุชูุธูู ูุจุฏุงุฆู ุทุจูุนูุฉ ุฎุงููุฉ ูู ุงููููุงููุงุช',
      'ุญุณููู ูุธุงูู ุงูุบุฐุงุฆู: ุฃูุซุฑู ูู ุงูุฎุถุงุฑ ูุงูุจุฑูุชูู ูุงูุฃูููุบุง 3',
      'ูุงูู 7-8 ุณุงุนุงุช ููููุงู ูุญุงูุธู ุนูู ุฑูุชูู ููู ุซุงุจุช',
      'ูููู ุงูุชูุชุฑ ุจููุงุฑุณุฉ ุงูููุบุง ุฃู ุงูุชุฃูู ููููุงู',
    ],
    'af': [
      'ุฌุฑุจู ูุตูุฉ ูุงุญุฏุฉ ูู ูุตูุงุช ุงูุฎุตูุจุฉ ุงูุชูููุฏูุฉ ูุงูุฃุณุจูุน',
      'ุฎุตุตู 15 ุฏูููุฉ ููููุงู ููุชุฃูู ูุงููุนู ุงูุฐุงุชู',
      'ุฌุฑุจู ุดุงู ุงูุฃุนุดุงุจ ุงููุนุฒุฒ ููุฎุตูุจุฉ (ุจุนุฏ ุงุณุชุดุงุฑุฉ ุทุจูุจ)',
      'ูุงุฑุณู ุชูุงุฑูู ุงูุชููุณ ุงูุนููู ูู ุตุจุงุญ',
      'ุงูุชุจู ููููุงุชู ุนู ูุดุงุนุฑู ูุฑุญูุชู ูุญู ุงูุฃูููุฉ',
      'ุญุถูุฑู ูุฌุจุฉ ุตุญูุฉ ูุงุนูุฉ ูุน ุดุฑููู ูุฑุฉ ุจุงูุฃุณุจูุน',
    ],
    'iwg': [
      'ูุง ุชุฎูู ุงูููู ูุณูุทุฑ ุนููู: ุฑูุฒู ุนูู ูุง ุชูุฏุฑูู ุชุชุญููู ููู',
      'ุชุญููู ูู ุงููุนูููุงุช ุงูุทุจูุฉ ูู ูุตุงุฏุฑ ุนูููุฉ ููุซููุฉ',
      'ูุง ุชุตุฏูู ูู ูุง ูููุงู ุนู ุงูุนูุฑ ูุงูุฎุตูุจุฉ',
      'ูุงุฑุณู ูุดุงุท ุจุฏูู ูุนุชุฏู 30 ุฏูููุฉ ููููุงู',
      'ุฑุงุฌุนู ุทุจูุจู ูููุญูุตุงุช ุงูุฃุณุงุณูุฉ ูุจู ูุง ุชุจุฏุฆู',
      'ูููู ุตุจูุฑุฉ: ูุนุธู ุงูุฃุฒูุงุฌ ูุญุชุงุฌูู 6-12 ุดูุฑ',
    ],
    'wbww': [
      'ุงุณุชูุนู ูุฌุณูู: ุณุฌูู ุฃู ุฃุนุฑุงุถ ุบูุฑ ุนุงุฏูุฉ',
      'ุงุนููู ูุญุต ุณููู ุดุงูู ุนูุฏ ุทุจูุจุฉ ุงููุณุงุก',
      'ุชุนููู ุนู ูุฑูููุงุชู ูููู ุชุคุซุฑ ุนูู ุตุญุชู',
      'ูุงุฑุณู ุงูุฑุนุงูุฉ ุงูุฐุงุชูุฉ: ุฎุตุตู ููุช ูููุณู ุฃุณุจูุนูุงู',
      'ุงูุฑุฆู ุนู ุตุญุฉ ุงูุซุฏู ูุทุฑู ุงููุญุต ุงูุฐุงุชู',
      'ุชุญุฏุซู ุจุตุฑุงุญุฉ ูุน ุทุจูุจุชู ุนู ุฃู ูุฎุงูู ุตุญูุฉ',
    ],
    'tfd': [
      'ุฃุถููู ุญูุถ ุงูููููู ููุธุงูู ุงูุบุฐุงุฆู ุงููููู',
      'ููู ุณูู ุฃูููุบุง 3 ูุฑุชูู ุจุงูุฃุณุจูุน ุนูู ุงูุฃูู',
      'ูููู ูู ุงูุณูุฑูุงุช ุงููุตูุนุฉ ูุงูุฃุทุนูุฉ ุงููุนุงูุฌุฉ',
      'ุงุดุฑุจู 8 ุฃููุงุจ ูุงุก ููููุงู ุนูู ุงูุฃูู',
      'ุฎุทุทู ูุฌุจุงุชู ุงูุฃุณุจูุนูุฉ ููุฏูุงู ูุน ุงูุชุฑููุฒ ุนูู ุงูุชููุน',
      'ุงุณุชุดูุฑู ุฃุฎุตุงุฆูุฉ ุชุบุฐูุฉ ูุฎุทุฉ ูุฎุตุตุฉ ููุถุนู',
    ],
    'ef': [
      'ุงูุชุจู ูุดุงุนุฑู ุนู ุฑุญูุฉ ุงูุฎุตูุจุฉ ุจุฏูู ุญูู ุนูู ููุณู',
      'ุชุญุฏุซู ูุน ุดุฑููู ุจุตุฑุงุญุฉ ุนู ูุฎุงูููู ูุขูุงููู',
      'ุงูุถูู ููุฌููุนุฉ ุฏุนู ูููุณุงุก ุงููู ููุฑูู ุจููุณ ุงูุชุฌุฑุจุฉ',
      'ุฎุฐู ุงุณุชุฑุงุญุฉ ูู ุงูุจุญุซ ุงูููุฑุท ุนูู ุงูุฅูุชุฑูุช',
      'ูุงุฑุณู ุชูุฑูู ูุงุญุฏ ูู ุชูุงุฑูู ุงูุงุณุชุฑุฎุงุก ููููุงู',
      'ุฐููุฑู ููุณู ุฅู ูุดุงุนุฑู ุทุจูุนูุฉ ูููุจููุฉ',
    ],
    'tft': [
      'ุฌูุฒู "ุฎุทุฉ ูุง ุจุนุฏ ุงูููุงุฏุฉ" ูู ุงูุญูู ูุจู ุงูููุงุฏุฉ',
      'ุฑุชุจู ูุธุงู ุฏุนู: ุญุฏุฏู ูู ููุฏุฑ ูุณุงุนุฏู ุจุนุฏ ุงูููุงุฏุฉ',
      'ุฌูุฒู ูุฌุจุงุช ุตุญูุฉ ูุฌูุฏุฉ ูุจู ููุนุฏ ุงูููุงุฏุฉ',
      'ุชุนููู ุนู ุชุบูุฑุงุช ุงูุฌุณู ุจุนุฏ ุงูููุงุฏุฉ ุนุดุงู ูุง ุชูุงุฌุฆู',
      'ูุงูุดู ูุน ุดุฑููู ุชูุฒูุน ุงูููุงู ุจุนุฏ ูุฌูุก ุงูุทูู',
      'ุญุถูุฑู ููุงู ูุฑูุญ ููุฑุถุงุนุฉ ูุงูุงุณุชุฑุฎุงุก',
    ],
    'prm': [
      'ุณุฌูู ุชูุงุตูู ุฏูุฑุชู ุงูุดูุฑูุฉ ููุฏุฉ 3 ุดููุฑ ูุชุชุงููุฉ',
      'ูููู ูู ุงูุฃุทุนูุฉ ุงููุณุจุจุฉ ููุงูุชูุงุจ (ุณูุฑุ ุทุญูู ุฃุจูุถ)',
      'ูุงุฑุณู ุฑูุงุถุฉ ูุนุชุฏูุฉ ุจุงูุชุธุงู ูุชูุธูู ุงููุฑูููุงุช',
      'ูุงูู ูู ุธูุงู ุชุงู ูุงุญุชุฑูู ุฅููุงุนู ุงูุจููููุฌู',
      'ุฌุฑุจู ููููุงุช ุงููุบููุณููู (ุจุนุฏ ุงุณุชุดุงุฑุฉ ุทุจูุจ)',
      'ุฑุงุฌุนู ุทุจูุจุฉ ูุฎุชุตุฉ ุฅุฐุง ุฏูุฑุชู ุบูุฑ ููุชุธูุฉ ูุฃูุซุฑ ูู 3 ุดููุฑ',
    ],
    'cpg': [
      'ุงุฌูุณูุง ุณูุง ูุงูุชุจูุง ูุงุฆูุฉ ุจุฃูุฏุงููู ุงููุดุชุฑูุฉ ููุฃุจูุฉ',
      'ูุงูุดูุง ููุฒุงููุฉ ุงูุทูู ูุงูุชุบููุฑุงุช ุงููุงููุฉ ุงููุชููุนุฉ',
      'ุงุชูููุง ุนูู ููุณูุฉ ุงูุชุฑุจูุฉ ูุจู ูุฌูุก ุงูุทูู',
      'ูุงุฑุณูุง ุชูุงุฑูู ุงูุชูุงุตู: ุงุณุชูุน ูุดุฑููู 5 ุฏูุงุฆู ุจุฏูู ููุงุทุนุฉ',
      'ุงุนูููุง ูุญูุตุงุช ุตุญูุฉ ููุฒูุฌูู ูุจู ุงูุจุฏุก',
      'ุฎุตุตูุง ููุนุฏ ุฃุณุจูุนู ููุฒูุฌูู ููุท ุจุฏูู ุฌูุงูุงุช',
    ],
    // Fatherhood
    'tef': [
      'ุงุญุถุฑ ููุงุนูุฏ ุงูุทุจูุจ ูุน ุฒูุฌุชู ูุฏุฑ ุงูุฅููุงู',
      'ุงูุฑุฃ ุนู ูุฑุงุญู ุงูุญูู ุดูุฑ ุจุดูุฑ ุนุดุงู ุชููู ูุด ูุตูุฑ',
      'ุฌูุฒ ุญููุจุฉ ุงููุณุชุดูู ูุน ุฒูุฌุชู ูุจู ุงูููุงุฏุฉ ุจุดูุฑ',
      'ุชุนูู ุฃุณุงุณูุงุช ุชุบููุฑ ุงูุญูุงุถุงุช ูุงูุงุณุชุญูุงู ููุฑุถูุน',
      'ุงุจุฏุฃ ุจุชุฌููุฒ ุบุฑูุฉ ุงูุทูู ููุณุชูุฒูุงุชู ุงูุฃุณุงุณูุฉ',
      'ุชุญุฏุซ ูุน ุขุจุงุก ุขุฎุฑูู ูุงุณุฃููู ุนู ุชุฌุฑุจุชูู',
    ],
    'tnf': [
      'ุฎุตุต 30 ุฏูููุฉ ููููุงู ููุนุจ ูุงูุชูุงุตู ูุน ุทููู',
      'ุดุงุฑู ูู ุงูุฑุถุนุงุช ุงูููููุฉ ุญุชู ูู ุจุงูุชูุงูุจ',
      'ุณุฌู ูุฑุงุญู ููู ุทููู: ุงูุงุจุชุณุงูุฉ ุงูุฃูููุ ุงููููุฉ ุงูุฃููู',
      'ุชุนูู ูุฑุงุกุฉ ุฅุดุงุฑุงุช ุทููู: ุฌูุนุงูุ ุชุนุจุงูุ ูุจู ููุนุจ',
      'ุญุงูุธ ุนูู ุนูุงูุชู ุจุฒูุฌุชู: ุฎุตุตูุง ููุช ููุฒูุฌูู',
      'ูุง ุชุฎุงู ุชุทูุจ ูุณุงุนุฏุฉ: ุงูุฃุจูุฉ ูู ุณููุฉ ุนูู ุฃุญุฏ',
    ],
    'tbp': [
      'ุงุญุถุฑ ุฏูุฑุฉ ุชุญุถูุฑูุฉ ููููุงุฏุฉ ูุน ุฒูุฌุชู',
      'ุชุนูู ุชูููุงุช ุงูุชููุณ ูุงูุชุฏููู ููุณุงุนุฏุฉ ุฒูุฌุชู ุฃุซูุงุก ุงูููุงุฏุฉ',
      'ุฌูุฒ ูุงุฆูุฉ ุจุฃุณุฆูุชู ููุทุจูุจ ูุจู ููุนุฏ ุงูููุงุฏุฉ',
      'ูู ุตูุช ุฒูุฌุชู ูู ุบุฑูุฉ ุงูููุงุฏุฉ ุฅุฐุง ุงุญุชุงุฌุช',
      'ุงุชูู ูุน ุฒูุฌุชู ุนูู ุฎุทุฉ ุงูููุงุฏุฉ ุงูููุถูุฉ',
      'ูู ุญุงุถุฑุงู ุจุงููุงูู: ุฃุบูู ุงูุฌูุงู ูุฑูุฒ ุนูููุง',
    ],
    'bp': [
      'ุชุฏุฑุจ ุนูู ุชุบููุฑ ุงูุญูุงุถ ูุจู ูุง ูุฌู ุงูุทูู (ุงุณุชุฎุฏู ุฏููุฉ)',
      'ุชุนูู ููู ุชูู ุงูุทูู ุจุงูุจุทุงููุฉ ุจุทุฑููุฉ ุขููุฉ',
      'ุฌูุฒ ุญููุจุฉ ุทูุงุฑุฆ ููุทูู ูู ุงูุณูุงุฑุฉ ูุงูุจูุช',
      'ุชุนูู ุงูุฅุณุนุงูุงุช ุงูุฃูููุฉ ููุฑุถุน',
      'ุงุตูุน ุฑูุชูู ูุน ุทููู: ูุตุฉ ูุจู ุงููููุ ุฃุบููุฉ ุฎุงุตุฉ',
      'ุงุณุชูุชุน ุจุงููุญุธุงุช ุงูุตุบูุฑุฉ ููุง ุชุถุบุท ุนูู ููุณู',
    ],
    'ndsg': [
      'ูุง ุชูุงุฑู ููุณู ุจุงูุขุจุงุก ุงูุซุงูููู ุนูู ุงูุณูุดู ููุฏูุง',
      'ูู ูู ูุง ุณูุญุช ูู ุงููุฑุตุฉ: ุงูููู ูู ุฑูุงููุฉ',
      'ุชูุจู ุฅูู ุจุชุบูุท ููุฐุง ุทุจูุนู ููุชููุน',
      'ูููู ุตุฏุงูุงุช ูุน ุขุจุงุก ุฌุฏุฏ ูููููู ูุถุนู',
      'ุญุงูุธ ุนูู ููุงูุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ุนุดุงู ุตุญุชู ุงูููุณูุฉ',
      'ุชูุงุตู ูุน ุฒูุฌุชู ููููุงู ุญุชู ูู 10 ุฏูุงุฆู ููุท',
    ],
    'tde': [
      'ุชุฏุฑุจ ุนูู ุงูุนุฏ ุฅูู 10 ูุจู ูุง ุชุฑุฏ ุจุนุตุจูุฉ ุนูู ุทููู',
      'ุงุชุฑู ุงูุฌูุงู ููู ุญุงุถุฑุงู 100% ููุช ุงููุนุจ ูุน ุฃุทูุงูู',
      'ุงุตูุน ุฐูุฑู ูุงุญุฏุฉ ูููุฒุฉ ูุน ุทููู ูู ุฃุณุจูุน',
      'ุงุณุฃู ุทููู ุนู ูููู ูุงุณุชูุน ุจุฌุฏ ูุงูุชุจุงู',
      'ูุงุฑุณ ุงูุฑูุงุถุฉ ุจุงูุชุธุงู: ุฌุณูู ูุนููู ูุญุชุงุฌูู ุงูุทุงูุฉ',
      'ุงูุชุจ ุฑุณุงูุฉ ุญุจ ููู ุทูู ูู ุฃุทูุงูู',
    ],
    'dad': [
      'ุฎุตุต ููุช ูุฑุฏู ูุน ูู ุทูู ุนูู ุญุฏุฉ ูู ุฃุณุจูุน',
      'ูู ุงููุฏูุฉ: ุฃุธูุฑ ุงูููู ุงููู ุชุจู ุชุดูููุง ูู ุฃุทูุงูู',
      'ุงุนุชุฐุฑ ูุฃุทูุงูู ููุง ุชุบูุท โ ูุฐู ููุฉ ูู ุถุนู',
      'ุงูุฑุฃ ูุฃุทูุงูู ูุจู ุงูููู ูู ูููุฉ',
      'ุนููู ุฃุทูุงูู ุงูุฐูุงุก ุงูุนุงุทูู: ุณููู ุงููุดุงุนุฑ ููุงูุดูุง',
      'ุงุญูู ูุฃุทูุงูู ุนู ุทูููุชู ูุชุฌุงุฑุจู ุจุตุฏู',
    ],
    'sfsd': [
      'ุฎุตุตู ููุช ุฃุณุจูุนู "ููุนุฏ ูุน ุจุงุจุง" ูุจูุชู ููุท',
      'ุงุณุชูุน ูุจูุชู ุจุฏูู ูุง ุชุญูู ุฃู ุชุญู ูุดุงูููุง ูุจุงุดุฑุฉ',
      'ูู ุญุงุถุฑุงู ูู ุงูููุงุณุจุงุช ุงููููุฉ ููุง ูููุง ูุงูุช ุตุบูุฑุฉ',
      'ุนุจูุฑ ูุจูุชู ุนู ุญุจู ููุฎุฑู ูููุง ุจุงูููุงู',
      'ุนููู ุจูุชู ุงูุซูุฉ ุจุงูููุณ ุจุชุดุฌูุนูุง ุนูู ุงููุญุงููุฉ',
      'ูู ุงููุซุงู ููุฑุฌู ุงููู ุชุชููุงู ูุจูุชู ุจุงููุณุชูุจู',
    ],
    'bdss': [
      'ุดุงุฑู ุงุจูู ูู ูุดุงุท ุจุฏูู ุฃู ูุบุงูุฑุฉ ูุฑุฉ ุจุงูุฃุณุจูุน',
      'ุนููู ุงุจูู ูุชุญูู ูุณุคูููุฉ ุฃูุนุงูู ูู ุตุบุฑู',
      'ูุงูุด ูุน ุงุจูู ูุนูู ุงูุฑุฌููุฉ ุงูุญููููุฉ: ุงูุงุญุชุฑุงู ูุงููุฒุงูุฉ',
      'ุฎู ุงุจูู ูุดููู ุชุนุชุฑู ุจุฃุฎุทุงุฆู ูุชุตูุญูุง',
      'ุดุฌุน ุงุจูู ุนูู ุงูุชุนุจูุฑ ุนู ูุดุงุนุฑู ุจุฏูู ุฎุฌู',
      'ูู ุงููุฑุดุฏ: ูุฌูู ุจุฏูู ูุง ุชุณูุทุฑ',
    ],
    'fhood': [
      'ุงูุชุจ ุฑุณุงูุฉ ูุทููู ุนู ุงูููู ุงููู ุตุฑุช ููู ุฃุจ',
      'ุดุงุฑู ูู ูุฌุชูุน ุงูุขุจุงุก ุงููุญูู ุฃู ุงูุฅููุชุฑููู',
      'ุชุนูู ูู ูุตุต ุขุจุงุก ูู ุฎูููุงุช ูุฎุชููุฉ ุนูู',
      'ูุงุฒู ุจูู ุทููุญุงุชู ุงูููููุฉ ูููุชู ูุน ุนุงุฆูุชู',
      'ุชุทููุน ูุน ุทููู ูู ุนูู ุฎูุฑู ูุนูููู ุงูุนุทุงุก',
      'ุชุฐูุฑ ุฅู ุงูุฃุจูุฉ ูุงุฑุงุซูู ูู ุณุจุงู ุณุฑุนุฉ',
    ],
    // Self-Management
    'ah': [
      'ุงุฎุชุฑ ุนุงุฏุฉ ุตุบูุฑุฉ ูุญุฏุฉ ูุทุจููุง ูู ููู ููุฏุฉ ุดูุฑ',
      'ุงุฑุจุท ุงูุนุงุฏุฉ ุงูุฌุฏูุฏุฉ ุจุนุงุฏุฉ ููุฌูุฏุฉ (ุชูุฏูุณ ุงูุนุงุฏุงุช)',
      'ุบููุฑ ุจูุฆุชู ุนุดุงู ุงูุนุงุฏุฉ ุงูุฌูุฏุฉ ุชููู ุณููุฉ ูุงูุณูุฆุฉ ุตุนุจุฉ',
      'ุชุชุจุน ุนุงุฏุงุชู ููููุงู ูู ุฏูุชุฑ ุฃู ุชุทุจูู',
      'ุทุจู ูุงุนุฏุฉ ุงูุฏูููุชูู: ุงุจุฏุฃ ุจูุณุฎุฉ ูุตุบุฑุฉ ูู ุฃู ุนุงุฏุฉ',
      'ุฑูุฒ ุนูู ูููุชู ุงูุฌุฏูุฏุฉ ูู ุจุณ ุงููุชูุฌุฉ ุงููุทููุจุฉ',
    ],
    '7h': [
      'ุงูุชุจ ุฑุณุงูุฉ ูููุชู ุงูุดุฎุตูุฉ ูู ุงูุญูุงุฉ',
      'ุญุฏุฏ ุฏุงุฆุฑุฉ ุชุฃุซูุฑู ูุฑูุฒ ุนูููุง ุจุฏู ุฏุงุฆุฑุฉ ุงูุชูุงูู',
      'ุทุจู ูุตูููุฉ ุฅุฏุงุฑุฉ ุงูููุช ูุฑูุฒ ุนูู ุงูููู ุบูุฑ ุงูุนุงุฌู',
      'ูุงุฑุณ ุงูุงุณุชูุงุน ุงูุชุนุงุทูู ูุน ุดุฎุต ูุงุญุฏ ูุงูุฃุณุจูุน',
      'ุฎุตุต ููุช ุฃุณุจูุนู ูุดุญุฐ ุงูููุดุงุฑ (ุฌุณูุ ุนููุ ุฑูุญุ ุนูุงูุงุช)',
      'ููุฑ ุจุงููููุนุฉ ุงููุดุชุฑูุฉ ูู ูู ุชุนุงูู ูุน ุงูุขุฎุฑูู',
    ],
    'tce': [
      'ุณุฌู ูู ูุฑุงุฑุงุชู ุงูุตุบูุฑุฉ ูููู ูุงูู ููููููุง',
      'ุฃุถู ุนุงุฏุฉ ุฅูุฌุงุจูุฉ ุตุบูุฑุฉ ูุงุญุฏุฉ ูุฑูุชููู ุงููููู',
      'ุงุญุณุจ ุงูุชุฃุซูุฑ ุงููุฑููุจ ูุนุงุฏุงุชู ุงูุญุงููุฉ ุจุนุฏ ุณูุฉ',
      'ุชุฎูุต ูู ุนุงุฏุฉ ุณูุจูุฉ ุตุบูุฑุฉ ูุงุญุฏุฉ ูุงูุฃุณุจูุน',
      'ุงุฎุชุฑ ูุญูุทู ุจุนูุงูุฉ โ ุงุจุชุนุฏ ุนู ุงููุคุซุฑุงุช ุงูุณูุจูุฉ',
      'ุงุนูู ุฃูุซุฑ ูู ุงููุทููุจ ุจูููู ูู ูู ูููุฉ (extra mile)',
    ],
    'ne': [
      'ุญุฏุฏ ุฃูู 3 ุฃูุฏุงู ูู ุญูุงุชู ูุงูุชุจูุง ุจูุถูุญ',
      'ูุงุฑุณ ุชุฃุฎูุฑ ุงููุชุนุฉ ูู ูุฑุงุฑ ูุงุญุฏ ููููุงู',
      'ุฎุตุต 30 ุฏูููุฉ ููููุงู ูููุฑุงุกุฉ ูุงูุชุทููุฑ ุงูุฐุงุชู',
      'ุถุน ููุฒุงููุฉ ุดูุฑูุฉ ูุงูุชุฒู ูููุง ุจุตุฑุงูุฉ',
      'ูุงุฑุณ ุงูุฑูุงุถุฉ 3 ูุฑุงุช ุฃุณุจูุนูุงู ุญุชู ูู ูุง ุชุจู',
      'ูู "ูุง" ูุดู ูุงุญุฏ ุนูู ุงูุฃูู ูู ููู ูุดุชุชู ุนู ุฃูุฏุงูู',
    ],
    'did': [
      'ุงุจุฏุฃ ูููู ุจุฑูุชูู ุตุจุงุญู ุซุงุจุช ูููุง ูุงูุช ุงูุธุฑูู',
      'ุงูุฑุฃ ุนู ุดุฎุตูุฉ ุชุงุฑูุฎูุฉ ุชุชููุฒ ุจุงูุงูุถุจุงุท ูุชุนูู ูููุง',
      'ูุงุฑุณ ุงูุงุนุชุฏุงู ูู ุดู ุชููู ููุฅูุฑุงุท ููู',
      'ุงูุชุจ ููููุงู ุนู ูุญุธุงุช ุถุนูู ูููู ุชุชุบูุจ ุนูููุง',
      'ุชุฏุฑุจ ุนูู ุงูุตุจุฑ ูู ูููู ุตุนุจ ุจุฏู ูุง ุชุฑุฏ ุจุณุฑุนุฉ',
      'ุงุฑุจุท ุงูุถุจุงุทู ุจูุฏู ุฃูุจุฑ โ ุงูุฅุฑุซ ุงููู ุชุจู ุชุชุฑูู',
    ],
    'tmiy': [
      'ุญุฏุฏ ููุท ุชุฎุฑูุจ ุฐุงุชู ูุงุญุฏ ุชูุงุฑุณู ููุงุฌูู ุจุตุฑุงุญุฉ',
      'ุงูุชุจ ุฑุณุงูุฉ ูููุณู ุงููุณุชูุจููุฉ ุนู ุงููู ุชุจู ุชุชุบูุจ ุนููู',
      'ุชุนูู ุชูุฑู ุจูู ุงูุฎูู ุงูุญูููู ูุงูููุงููุฉ ุงูุฏุงุฎููุฉ',
      'ูุงุฑุณ ุชูุฑูู ุงููุดุงุนุฑ: ุงูุชุจ ูุด ุชุญุณ ููู ุจุฏูู ุญูู',
      'ุบููุฑ ุงุณุชุฌุงุจุชู ููููู ูุงุญุฏ ูุชูุฑุฑ ููุณุจุจ ูู ูุดุงูู',
      'ุชุนุงูู ูุน ูู ุนูุจุฉ ููุฑุตุฉ ููู ูู ูุนุงุฆู',
    ],
    'sdb': [
      'ุญุฏุฏ ุนุงุฏุฉ ุฃุณุงุณูุฉ ูุงุญุฏุฉ (keystone habit) ูุฑูุฒ ุนูููุง',
      'ุตูู ุจูุฆุชู ุนุดุงู ุชุฏุนู ุงูุถุจุงุทู ุจุฏู ูุง ุชุนุชูุฏ ุนูู ุงูุฅุฑุงุฏุฉ',
      'ุงุนูู ูุธุงู ูุณุคูููุฉ ูุน ุตุฏูู ุฃู ุดุฑูู',
      'ุชุนูู ุชุนุฑู ูุญูุฒุงุช ุงูุนุงุฏุงุช ุงูุณูุฆุฉ ูุชุชุฌูุจูุง',
      'ุงุจูู ุฑูุชูู ูุณุงุฆู ูููุฆู ูููู ุฌูุฏ ูุตุจุงุญ ููุชุฌ',
      'ุฑุงุฌุน ุชูุฏูู ุฃุณุจูุนูุงู ูุนุฏูู ุฎุทุชู ุญุณุจ ุงูุญุงุฌุฉ',
    ],
    '15c': [
      'ูุงุญุธ ูุชู ุชููู "ุชุญุช ุงูุฎุท" (ุฏูุงุนู) ูุงุฑุฌุน ูููู',
      'ูุงุฑุณ ุงููุถูู ุจุฏู ุงูุฏูุงุน ูู ุงูุฎูุงู ุงูุฌุงู',
      'ุชุญูู ุงููุณุคูููุฉ ุงููุงููุฉ ุนู ูููู ูุงุญุฏ ุจุฏูู ููู',
      'ุงุณุฃู ููุณู: ูู ูุฐุง ุญูููุฉ ููุง ูุตุฉ ุฃูุง ุฃุฎุชุฑุนุชูุงุ',
      'ุนุจูุฑ ุนู ุชูุฏูุฑู ูุดุฎุต ูุงุญุฏ ููููุงู ุจุดูู ุตุงุฏู',
      'ุฎุตุต ููุช ููุนุจ ูุงูุฑุงุญุฉ ูุฌุฒุก ูู ููุงุฏุชู ูููุณู',
    ],
    'lwnt': [
      'ุชุตุฑู ููุงุฆุฏ ูู ูููุนู ุงูุญุงูู ุจุฏูู ูุง ุชูุชุธุฑ ููุตุจ',
      'ุงุจุชูุฑ ุชุญุณูู ูุงุญุฏ ูู ุดุบูู ูุงูุฃุณุจูุน ุจุฏูู ูุง ุฃุญุฏ ูุทูุจ',
      'ุงูุชู ุจุฌูุฏุฉ ุนููู ุงููููู ุญุชู ูู ุงูููุงู ุงูุตุบูุฑุฉ',
      'ุงุจูู ุนูุงูุฉ ูููุฉ ูุน ุฒููู ูุงุญุฏ ุฌุฏูุฏ ูู ุดูุฑ',
      'ุทููุฑ ุทููุณ ููููุฉ ููุชููุฒ (ูุฑุงุกุฉุ ุชุฃููุ ุฑูุงุถุฉ)',
      'ุงุณุฃู ููุณู ูู ูุณุงุก: ูู ูุฏุช ุงูููู ููุง ุจุณ ูุฑูุชุ',
    ],
    // Marriage
    '7pm': [
      'ุงุนูู ุฎุฑูุทุฉ ุญุจ ูุดุฑููู: ุงูุชุจ ุฃุญูุงูู ููุฎุงููู ูุชูุถููุงุชู',
      'ุนุจูุฑ ุนู ุฅุนุฌุงุจู ูุชูุฏูุฑู ูุดุฑููู ูู ููู ุจุดูู ูุญุฏุฏ',
      'ุงุณุชุฌุจ ูู"ูุญุงููุงุช ุงูุชูุงุตู" ุงูุตุบูุฑุฉ ุจุฏู ูุง ุชุชุฌุงูููุง',
      'ุญุงูุธ ุนูู ูุณุจุฉ 5:1 โ ุฎูุณ ุชูุงุนูุงุช ุฅูุฌุงุจูุฉ ููู ุณูุจูุฉ',
      'ุชุนูู ุชุนุฑู ุงููุฑุณุงู ุงูุฃุฑุจุนุฉ (ุงูููุฏุ ุงูุงุญุชูุงุฑุ ุงูุฏูุงุนูุฉุ ุงูุงูุณุญุงุจ)',
      'ูุงุฑุณ ูุญุงููุงุช ุงูุฅุตูุงุญ ููุง ุงูุฎูุงู ูุญุชุฏ ุจุฏู ูุง ุชุณุชูุฑ',
    ],
    'hmt': [
      'ุญุฏุฏ ููุท ุงูุตุฑุงุน ุงููุชูุฑุฑ ุจููู ูุจูู ุดุฑููู',
      'ุนุจูุฑ ุนู ุงุญุชูุงุฌู ุงูุนุงุทูู ุจุฏู ูุง ุชูุชูุฏ ุณููู ุดุฑููู',
      'ูุงุฑุณ ูุญุงุฏุซุฉ "ุงุญุถูู ุจููุฉ" โ ุนุจูุฑ ุนู ุฎููู ุจุตุฑุงุญุฉ',
      'ุงุณุฃู ุดุฑููู: ูู ุฃูุช ููุฌูุฏ ููุชุงุญ ูู ุนุงุทููุงูุ',
      'ุงุนุชุฐุฑ ุนู ุฌุฑุญ ุนุงุทูู ูุฏูู ูุงูุชุญ ุจุงุจ ุงููุณุงูุญุฉ',
      'ุฎุตุต ููุช ูููู ููุชูุงุตู ุงูุนุงุทูู ุจุฏูู ุดุงุดุงุช',
    ],
    'wfl': [
      'ุงูุชุดู ููุท ุงุฑุชุจุงุทู ูููุท ุดุฑููู (ูุฑุณุงุฉุ ุฌุฒูุฑุฉุ ููุฌุฉ)',
      'ุงุนูู ุทูุณ ุตุจุงุญู ููุณุงุฆู ููุชูุงุตู ูุน ุดุฑููู',
      'ุชุนูู ุชูุฏูุฆ ุฌูุงุฒู ุงูุนุตุจู ูุจู ูุง ุชุฑุฏ ูู ุงูุฎูุงู',
      'ุงุจูู "ููุงุนุฉ ุงูุฒูุฌูู" โ ุงุชูููุง ุฅููู ูุฑูู ูุงุญุฏ ุฏุงููุงู',
      'ูุงุญุธ ูุบุฉ ุฌุณุฏ ุดุฑููู ูุงุณุชุฌุจ ููุง ูุจู ูุง ูุชููู',
      'ูุงุฑุณ ุงูุชูุธูู ุงููุดุชุฑู: ูุฏูุฆ ุดุฑููู ุจููุณุฉ ุฃู ูููุฉ ุญูููุฉ',
    ],
    'gtlyw': [
      'ุงูุชุจ ูุงุฆูุฉ ุจุตูุงุช ุดุฑููู ุงููู ุชุดุจู ูุงูุฏูู (ุงูุฅูุฌุงุจูุฉ ูุงูุณูุจูุฉ)',
      'ูุงุฑุณ ุญูุงุฑ ุงูุฅููุงุบู: ุงุณุชูุนุ ุนูุณุ ุชุญููุ ุชุนุงุทู',
      'ุญููู ุฅุญุจุงุทู ูู ุดุฑููู ูุทูุจ ููู ูุญุฏุฏ',
      'ุฃุบูู ูุฎุฑุฌ ูุงุญุฏ ุชุณุชุฎุฏูู ูููุฑูุจ ูู ุงูุนูุงูุฉ',
      'ุฎุตุต ููุนุฏ ุฃุณุจูุนู ูุน ุดุฑููู ุจุฏูู ุฃุทูุงู ุฃู ุดุงุดุงุช',
      'ุชุฐูุฑ ุฅู ุดุฑููู ูุฑุขุฉ ููููู โ ูุง ุงุฎุชุฑุชู ุจุงูุตุฏูุฉ',
    ],
    '5ll': [
      'ุงูุชุดู ูุบุฉ ุญุจู ููุบุฉ ุญุจ ุดุฑููู ูู ุฎูุงู ุงูุงุฎุชุจุงุฑ',
      'ุนุจูุฑ ุนู ุญุจู ุจูุบุฉ ุดุฑููู ูู ุจูุบุชู ุฃูุช ูู ููู',
      'ุงุทูุจ ูู ุดุฑููู ูููู ูู ูุด ูุฎููู ูุญุณ ุจุญุจู',
      'ูุงุฑุณ ูุบุฉ ุญุจ ูุฎุชููุฉ ูู ุฃุณุจูุน ูุดูู ุงูุชุฃุซูุฑ',
      'ุงููุฃ ุฎุฒุงู ุญุจ ุดุฑููู ูุจู ูุง ุชุทูุจ ููู ุดู',
      'ุนููู ุฃุทูุงูู ูุบุงุช ุงูุญุจ ุงูุฎูุณ ูุงุณุชุฎุฏููุง ูุนูู',
    ],
    'nvc': [
      'ุชุฏุฑุจ ุนูู ุงูููุงุญุธุฉ ุจุฏูู ุฅุตุฏุงุฑ ุฃุญูุงู ูู ูููู ูุงุญุฏ ููููุงู',
      'ุนุจูุฑ ุนู ูุดุงุนุฑู ุจุฏู ูุง ุชููู ุงูุทุฑู ุงูุซุงูู',
      'ุญุฏุฏ ุงุญุชูุงุฌู ุงูุญูููู ูุฑุง ูู ุฎูุงู',
      'ุญููู ูุทุงูุจู ูุทูุจุงุช ูุงุถุญุฉ ููุงุจูุฉ ููุชูููุฐ',
      'ุงุณุชูุน ููุดุงุนุฑ ุดุฑููู ุจุชุนุงุทู ูุจู ูุง ุชุฑุฏ',
      'ุงุณุชุฎุฏู ุตูุบุฉ: "ููุง ูุตูุฑ... ุฃุญุณ... ูุฃูู ุฃุญุชุงุฌ... ูู ูููู..."',
    ],
    '8d': [
      'ุฎุทุท ูููุนุฏ ุฃุณุจูุนู ูุน ุดุฑููู ูุงุฎุชุงุฑูุง ููุถูุน ููููุงุด',
      'ุงุจุฏุฃ ุจููุนุฏ ุงูุซูุฉ โ ุงุณุฃููุง ุจุนุถ ุฃุณุฆูุฉ ุนูููุฉ ุนู ุงูุงูุชุฒุงู',
      'ูุงูุดูุง ุทุฑููุชูู ูู ุญู ุงูุฎูุงูุงุช ุจุตุฑุงุญุฉ ููุฏูุก',
      'ุชููููุง ุนู ุฃุญูุงููู ุงููุดุชุฑูุฉ ูููู ุชุญูููููุง ูุน ุจุนุถ',
      'ุฎุทุทูุง ููุบุงูุฑุฉ ุฃู ูุดุงุท ููุชุน ูุง ุณููุชูู ูุจู',
      'ุงุฎุชููุง ูู ููุนุฏ ุจุณุคุงู: ูุด ุงูุดู ุงููู ุชุนููุชู ุนูู ุงููููุ',
    ],
    'sm': [
      'ุงุณุฃู ููุณู: ููู ุฒูุงุฌู ูุฎูููู ุฃููู ูุฅูุณุงูุ',
      'ุชุนุงูู ูุน ุงูุชุญุฏูุงุช ุงูุฒูุฌูุฉ ููุฑุต ููุชุทููุฑ ูู ููุดุงูู',
      'ูุงุฑุณ ุงูุชุณุงูุญ ุญุชู ูู ูุง ุญุณูุช ุฅูู ูุณุชุนุฏ',
      'ุงุฎุฏู ุดุฑููู ูู ุดู ุตุบูุฑ ูู ููู ุจุฏูู ููุงุจู',
      'ูุงูุด ูุน ุดุฑููู: ูุด ุงููุฏู ุงูุฃุนูู ูู ุฒูุงุฌูุงุ',
      'ุงูุฑุฃ ูุน ุดุฑููู ูุตู ูุงุญุฏ ุฃุณุจูุนูุงู ููุงูุดูู',
    ],
    'pasm': [
      'ูุงุฌู ููุณู ุจุตุฑุงุญุฉ: ูุด ุงููู ุชุชุฌูุจู ูู ุนูุงูุชูุ',
      'ูุงุฑุณ ุงูุชูุงูุฒ: ุญุงูุธ ุนูู ุฐุงุชู ุฏุงุฎู ุงูุนูุงูุฉ',
      'ุงูุชุญ ูุญุงุฏุซุฉ ุนู ุงูุญููููุฉ ูุน ุดุฑููู ุจุดุฌุงุนุฉ',
      'ุชูุจู ุฅู ุงูุฎูุงู ุฌุฒุก ุทุจูุนู ูู ุงูููู ูู ุงูุฒูุงุฌ',
      'ุงุณุชุซูุฑ ูู ููุณู ุนุดุงู ุชูุฏู ูุณุฎุฉ ุฃูุถู ูุดุฑููู',
      'ุฌุฏุฏ ุงูุดุบู ุจุชุฌุฑุจุฉ ุดู ุฌุฏูุฏ ูุน ุดุฑููู ูู ุดูุฑ',
    ],
    'db': [
      'ุฑูุฒ ุนูู ุงูุญููู ุจุฏู ูุง ุชุญูู ุงููุดุงูู ูุงููุงุถู',
      'ุณููู ุฃูุซุฑ ูู ุงููู ูููุน ูููู ุงููู ูุง ูููุน',
      'ุบููุฑ ุณูููู ุฃูุช ุฃูู ุญุชู ูู ุญุงุณุณ ุฅู ุงููุดููุฉ ูู ุงูุซุงูู',
      'ูุงุญุธ ุงูุฃููุงุช ุงููู ุนูุงูุชูู ุชููู ูููุง ุฃุญุณู โ ูุด ุงููู ูุฎุชููุ',
      'ุฌุฑุจ ุดู ูุฎุชูู ุชูุงูุงู ููุง ุงูุทุฑููุฉ ุงูุญุงููุฉ ูุง ุชููุน',
      'ุชุฐูุฑ ุฅู ุงูุชุบููุฑุงุช ุงูุตุบูุฑุฉ ุชุตูุน ูุชุงุฆุฌ ูุจูุฑุฉ ูู ุงูุนูุงูุฉ',
    ],
  };

  // ==================== STATE ====================

  let currentView = 'library';
  let currentBookPath = null;
  let readingTimerStart = null;
  let readingTimerInterval = null;
  let currentFilter = 'all';
  let currentCategoryFilter = 'all';
  let currentSearchQuery = '';
  let currentHighlightColor = 'yellow';
  let highlightModeActive = false;
  let currentZoom = 1.0;
  let currentFontSize = 18;
  let currentFontFamily = 'Tajawal';
  let currentTheme = 'dark';
  let currentScrollPercent = 0;

  // ==================== INITIALIZATION ====================

  async function init() {
    try {
      await DB.init();
      console.log('DB initialized');

      // Load persisted settings
      const savedTheme = await DB.getSetting('theme');
      const savedFontSize = await DB.getSetting('fontSize');
      const savedFontFamily = await DB.getSetting('fontFamily');
      const savedZoom = await DB.getSetting('zoom');

      if (savedTheme) currentTheme = savedTheme;
      if (savedFontSize) currentFontSize = savedFontSize;
      if (savedFontFamily) currentFontFamily = savedFontFamily;
      if (savedZoom) currentZoom = savedZoom;

      applyTheme(currentTheme);
      applyFontToBody();
      await renderLibrary();
      setupBottomNav();
      setupEventListeners();
      await updateStreakBadge();
      registerServiceWorker();

      // Check if we should restore a book from hash
      if (window.location.hash) {
        const hash = window.location.hash.substring(1);
        if (hash.startsWith('book:')) {
          const bookPath = decodeURIComponent(hash.substring(5));
          await openBook(bookPath);
        } else if (['dashboard', 'quotes', 'actions', 'settings'].includes(hash)) {
          switchView(hash);
        }
      }

      console.log('App initialized');
    } catch (err) {
      console.error('App init failed:', err);
    }
  }

  // ==================== SERVICE WORKER ====================

  function registerServiceWorker() {
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(
        (reg) => console.log('SW registered:', reg.scope),
        (err) => console.warn('SW registration failed:', err)
      );
    }
  }

  // ==================== THEME ====================

  function applyTheme(theme) {
    currentTheme = theme;
    document.documentElement.setAttribute('data-theme', theme);
    document.body.setAttribute('data-theme', theme);
    DB.setSetting('theme', theme);

    // Update meta theme-color for browser chrome
    const themeColors = { dark: '#0f0f1a', light: '#f5f5f5', sepia: '#f4ecd8' };
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    if (metaTheme) metaTheme.setAttribute('content', themeColors[theme] || '#0f0f1a');

    // Send to iframe if open
    const frame = document.getElementById('book-frame');
    if (frame && frame.contentWindow) {
      try {
        frame.contentWindow.postMessage({ type: 'SET_THEME', theme }, '*');
      } catch (e) { /* cross-origin */ }
    }
  }

  // ==================== VIEW NAVIGATION ====================

  function switchView(viewId) {
    const views = ['library', 'reader', 'dashboard', 'quotes', 'actions', 'settings'];
    views.forEach((v) => {
      const el = document.getElementById('view-' + v);
      if (el) el.classList.remove('active');
    });

    const target = document.getElementById('view-' + viewId);
    if (target) target.classList.add('active');

    currentView = viewId;

    // Update bottom nav active state
    const navItems = document.querySelectorAll('#bottom-nav [data-view]');
    navItems.forEach((item) => {
      item.classList.toggle('active', item.getAttribute('data-view') === viewId);
    });

    // Show/hide bottom nav and body class in reader
    const isReader = viewId === 'reader';
    document.body.classList.toggle('reading', isReader);
    const bottomNav = document.getElementById('bottom-nav');
    if (bottomNav) {
      bottomNav.style.display = isReader ? 'none' : '';
    }

    // Reset library header visibility when switching back to library
    if (viewId === 'library') {
      const header = document.querySelector('.library-header');
      const search = document.querySelector('.search-container');
      const filters = document.querySelector('.filter-tabs');
      if (header) header.classList.remove('header-hidden');
      if (search) search.classList.remove('header-hidden');
      if (filters) filters.classList.remove('header-hidden');
    }

    // Render view content on switch
    if (viewId === 'dashboard') renderDashboard();
    if (viewId === 'quotes') renderQuotes();
    if (viewId === 'actions') renderActions();
    if (viewId === 'settings') renderSettings();
    if (viewId === 'library') renderLibrary();

    // Update URL hash for non-reader views
    if (viewId !== 'reader' && viewId !== 'library') {
      history.pushState({ view: viewId }, '', '#' + viewId);
    } else if (viewId === 'library') {
      history.pushState({ view: 'library' }, '', window.location.pathname);
    }
  }

  // ==================== BOTTOM NAV ====================

  function setupBottomNav() {
    const nav = document.getElementById('bottom-nav');
    if (!nav) return;

    nav.innerHTML = `
      <button class="nav-item active" data-view="library">
        <span class="nav-icon">\uD83D\uDCDA</span>
        <span class="nav-label">\u0627\u0644\u0645\u0643\u062A\u0628\u0629</span>
      </button>
      <button class="nav-item" data-view="dashboard">
        <span class="nav-icon">\uD83D\uDCCA</span>
        <span class="nav-label">\u0625\u062D\u0635\u0627\u0626\u064A\u0627\u062A</span>
      </button>
      <button class="nav-item" data-view="quotes">
        <span class="nav-icon">\uD83D\uDCDD</span>
        <span class="nav-label">\u0627\u0642\u062A\u0628\u0627\u0633\u0627\u062A</span>
      </button>
      <button class="nav-item" data-view="actions">
        <span class="nav-icon">\u2705</span>
        <span class="nav-label">\u0625\u062C\u0631\u0627\u0621\u0627\u062A</span>
      </button>
      <button class="nav-item" data-view="settings">
        <span class="nav-icon">\u2699\uFE0F</span>
        <span class="nav-label">\u0625\u0639\u062F\u0627\u062F\u0627\u062A</span>
      </button>
    `;

    nav.addEventListener('click', (e) => {
      const item = e.target.closest('[data-view]');
      if (item) {
        switchView(item.getAttribute('data-view'));
      }
    });
  }

  // ==================== EVENT LISTENERS ====================

  function setupEventListeners() {
    // Search input
    const searchInput = document.getElementById('search-input');
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        currentSearchQuery = e.target.value.trim();
        renderLibrary();
      });
    }

    // Filter tabs
    const filterTabs = document.getElementById('filter-tabs');
    if (filterTabs) {
      filterTabs.addEventListener('click', (e) => {
        const tab = e.target.closest('[data-filter]');
        if (tab) {
          currentFilter = tab.getAttribute('data-filter');
          filterTabs.querySelectorAll('[data-filter]').forEach((t) =>
            t.classList.toggle('active', t === tab)
          );
          renderLibrary();
        }
      });
    }

    // Reader close button
    const btnClose = document.getElementById('btn-close-reader');
    if (btnClose) {
      btnClose.addEventListener('click', () => closeBook());
    }

    // Reader bookmark button
    const btnBookmark = document.getElementById('btn-bookmark');
    if (btnBookmark) {
      btnBookmark.addEventListener('click', () => addBookmarkAtCurrentPosition());
    }

    // TOC button
    const btnToc = document.getElementById('btn-toc');
    if (btnToc) {
      btnToc.addEventListener('click', () => showTableOfContents());
    }

    // Reader font settings button
    const btnFont = document.getElementById('btn-font-settings');
    if (btnFont) {
      btnFont.addEventListener('click', () => toggleFontPanel());
    }

    // Library scroll direction detection (hide header on scroll down)
    setupLibraryScrollHide();

    // Listen for messages from iframe
    window.addEventListener('message', handleIframeMessage);

    // History back button
    window.addEventListener('popstate', (event) => {
      if (currentView === 'reader') {
        closeBook();
      } else if (event.state && event.state.view) {
        switchView(event.state.view);
      } else {
        switchView('library');
      }
    });
  }

  // ==================== LIBRARY SCROLL HIDE ====================

  function setupLibraryScrollHide() {
    let lastScrollTop = 0;
    let scrollDirection = '';
    const libraryView = document.getElementById('view-library');
    if (!libraryView) return;

    window.addEventListener('scroll', () => {
      // Only apply on library view
      if (currentView !== 'library') return;

      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const delta = scrollTop - lastScrollTop;

      if (Math.abs(delta) > 8) {
        const newDir = delta > 0 ? 'down' : 'up';
        if (newDir !== scrollDirection) {
          scrollDirection = newDir;
          const header = document.querySelector('.library-header');
          const search = document.querySelector('.search-container');
          const filters = document.querySelector('.filter-tabs');

          if (scrollDirection === 'down' && scrollTop > 100) {
            if (header) header.classList.add('header-hidden');
            if (search) search.classList.add('header-hidden');
            if (filters) filters.classList.add('header-hidden');
          } else {
            if (header) header.classList.remove('header-hidden');
            if (search) search.classList.remove('header-hidden');
            if (filters) filters.classList.remove('header-hidden');
          }
        }
        lastScrollTop = scrollTop;
      }
    }, { passive: true });
  }

  // ==================== FONT APPLICATION ====================

  function applyFontToBody() {
    // Remove all font classes
    document.body.classList.remove('font-tajawal', 'font-noto', 'font-amiri');

    // Add the correct one
    if (currentFontFamily === 'Tajawal') document.body.classList.add('font-tajawal');
    else if (currentFontFamily === 'Noto Naskh Arabic') document.body.classList.add('font-noto');
    else if (currentFontFamily === 'Amiri') document.body.classList.add('font-amiri');
  }

  // ==================== STREAK BADGE ====================

  async function updateStreakBadge() {
    const badge = document.getElementById('streak-badge');
    if (!badge) return;

    const streak = await DB.getStreak();
    if (streak > 0) {
      badge.textContent = streak + ' \uD83D\uDD25';
      badge.style.display = '';
    } else {
      badge.style.display = 'none';
    }
  }

  // ==================== LIBRARY VIEW ====================

  async function renderLibrary() {
    const grid = document.getElementById('books-grid');
    if (!grid) return;

    // Get all reading progress
    const allProgress = await DB.getAllProgress();
    const progressMap = {};
    allProgress.forEach((p) => { progressMap[p.bookPath] = p; });

    // Filter books
    let filtered = [...BOOKS];

    // Text search
    if (currentSearchQuery) {
      const q = currentSearchQuery.toLowerCase();
      filtered = filtered.filter((b) =>
        b.title.toLowerCase().includes(q) ||
        b.subtitle.toLowerCase().includes(q) ||
        b.author.toLowerCase().includes(q) ||
        b.authorEn.toLowerCase().includes(q)
      );
    }

    // Status filter
    if (currentFilter === 'unread') {
      filtered = filtered.filter((b) => !progressMap[b.path]);
    } else if (currentFilter === 'reading') {
      filtered = filtered.filter((b) => {
        const p = progressMap[b.path];
        return p && !p.isCompleted && p.scrollPercent > 0;
      });
    } else if (currentFilter === 'completed') {
      filtered = filtered.filter((b) => {
        const p = progressMap[b.path];
        return p && p.isCompleted;
      });
    }

    // Category filter
    if (currentCategoryFilter !== 'all') {
      filtered = filtered.filter((b) => b.category === currentCategoryFilter);
    }

    // Group by category
    const grouped = {};
    filtered.forEach((book) => {
      if (!grouped[book.category]) grouped[book.category] = [];
      grouped[book.category].push(book);
    });

    let html = '';
    let cardIndex = 0;

    // Render filter tabs if not already rendered
    const filterTabsEl = document.getElementById('filter-tabs');
    if (filterTabsEl && !filterTabsEl.hasChildNodes()) {
      filterTabsEl.innerHTML = `
        <button class="filter-tab active" data-filter="all">\u0627\u0644\u0643\u0644</button>
        <button class="filter-tab" data-filter="unread">\u0644\u0645 \u064A\u064F\u0642\u0631\u0623</button>
        <button class="filter-tab" data-filter="reading">\u0642\u064A\u062F \u0627\u0644\u0642\u0631\u0627\u0621\u0629</button>
        <button class="filter-tab" data-filter="completed">\u0645\u0643\u062A\u0645\u0644</button>
      `;
    }

    // Render category filter buttons
    html += '<div class="category-filters">';
    html += `<button class="cat-filter-btn ${currentCategoryFilter === 'all' ? 'active' : ''}" data-cat="all">\u0627\u0644\u0643\u0644</button>`;
    CATEGORIES.forEach((cat) => {
      html += `<button class="cat-filter-btn ${currentCategoryFilter === cat.id ? 'active' : ''}" data-cat="${cat.id}">${cat.icon} ${cat.ar}</button>`;
    });
    html += '</div>';

    // Render grouped books
    const categoryOrder = ['productivity', 'finance', 'biography', 'pregnancy', 'fatherhood', 'selfmgmt', 'marriage'];
    categoryOrder.forEach((catId) => {
      const books = grouped[catId];
      if (!books || books.length === 0) return;

      const cat = CATEGORIES.find((c) => c.id === catId);
      html += `<section class="category-section">`;
      html += `<h2 class="category-heading"><span>${cat.icon}</span> ${cat.ar}</h2>`;
      html += `<div class="category-grid">`;

      books.forEach((book) => {
        const progress = progressMap[book.path];
        let statusBadge = '';
        let progressBar = '';

        if (progress && progress.isCompleted) {
          statusBadge = `<span class="status-badge completed">\u0645\u0643\u062A\u0645\u0644</span>`;
        } else if (progress && progress.scrollPercent > 0) {
          const pct = Math.round(progress.scrollPercent);
          statusBadge = `<span class="status-badge reading">\u064A\u064F\u0642\u0631\u0623 ${pct}%</span>`;
          progressBar = `<div class="card-progress"><div class="card-progress-fill" style="width:${pct}%"></div></div>`;
        }

        html += `
          <div class="book-card" data-color="${book.color}" style="--i:${cardIndex}" onclick="App.openBook('${book.path}')">
            <div class="book-cover">${book.emoji}</div>
            <div class="book-info">
              ${statusBadge}
              <h3 class="book-title">${book.title}</h3>
              <p class="book-subtitle">${book.subtitle}</p>
              <p class="book-author">${book.author}</p>
              <span class="book-tag">${book.chapters} \u0641\u0635\u0644</span>
              ${progressBar}
            </div>
          </div>
        `;
        cardIndex++;
      });

      html += `</div></section>`;
    });

    if (filtered.length === 0) {
      html += `<div class="empty-state"><p>\u0644\u0627 \u062A\u0648\u062C\u062F \u0643\u062A\u0628 \u0645\u0637\u0627\u0628\u0642\u0629</p></div>`;
    }

    grid.innerHTML = html;

    // Attach category filter listeners
    grid.querySelectorAll('.cat-filter-btn').forEach((btn) => {
      btn.addEventListener('click', (e) => {
        currentCategoryFilter = e.target.getAttribute('data-cat');
        renderLibrary();
      });
    });
  }

  // ==================== BOOK READER ====================

  async function openBook(bookPath) {
    currentBookPath = bookPath;
    switchView('reader');

    // Reset immersive state โ show header when opening a book
    const rh = document.querySelector('.reader-header');
    const rp = document.querySelector('.reader-progress-container');
    const bf = document.getElementById('book-frame');
    if (rh) rh.classList.remove('reader-hidden');
    if (rp) rp.classList.remove('reader-hidden');
    if (bf) bf.classList.remove('immersive');

    const frame = document.getElementById('book-frame');
    if (frame) {
      frame.src = bookPath;
    }

    // Update reader title
    const book = BOOKS.find((b) => b.path === bookPath);
    const readerTitle = document.getElementById('reader-title');
    if (readerTitle && book) {
      readerTitle.textContent = book.title;
    }

    // Save currently reading book
    await DB.setSetting('currentBook', bookPath);

    // Log book opened in daily stats
    await DB.logBookOpened(bookPath);

    // Start reading timer
    startReadingTimer();

    // Update streak
    await updateStreakBadge();

    // History
    history.pushState({ book: bookPath }, '', '#book:' + encodeURIComponent(bookPath));

    // Wait for iframe load to send settings
    if (frame) {
      frame.onload = async () => {
        await sendSettingsToIframe();
        await sendSavedDataToIframe(bookPath);
      };
    }
  }

  async function closeBook() {
    // Save final position
    if (currentBookPath && currentScrollPercent > 0) {
      await DB.saveProgress(currentBookPath, {
        scrollPercent: currentScrollPercent,
        lastReadAt: Date.now(),
      });
    }

    // Stop reading timer and log time
    stopReadingTimer();

    // Clear iframe
    const frame = document.getElementById('book-frame');
    if (frame) {
      frame.src = '';
      frame.onload = null;
    }

    currentBookPath = null;
    currentScrollPercent = 0;
    highlightModeActive = false;

    await DB.setSetting('currentBook', null);
    switchView('library');
  }

  async function sendSettingsToIframe() {
    const frame = document.getElementById('book-frame');
    if (!frame || !frame.contentWindow) return;

    try {
      frame.contentWindow.postMessage({
        type: 'SET_THEME',
        theme: currentTheme,
      }, '*');

      frame.contentWindow.postMessage({
        type: 'SET_FONT_SIZE',
        size: currentFontSize,
      }, '*');

      frame.contentWindow.postMessage({
        type: 'SET_FONT_FAMILY',
        family: currentFontFamily,
      }, '*');

      frame.contentWindow.postMessage({
        type: 'SET_ZOOM',
        zoom: currentZoom,
      }, '*');
    } catch (e) {
      console.warn('Failed to send settings to iframe:', e);
    }
  }

  async function sendSavedDataToIframe(bookPath) {
    const frame = document.getElementById('book-frame');
    if (!frame || !frame.contentWindow) return;

    try {
      // Send all saved data via INIT message (single message, handles everything)
      const progress = await DB.getProgress(bookPath);
      const highlights = await DB.getHighlights(bookPath);
      const comments = await DB.getComments(bookPath);

      frame.contentWindow.postMessage({
        type: 'INIT',
        theme: currentTheme,
        fontSize: currentFontSize,
        fontFamily: currentFontFamily,
        zoom: currentZoom,
        scrollPercent: progress ? progress.scrollPercent : 0,
        highlights: highlights || [],
        comments: comments || [],
      }, '*');
    } catch (e) {
      console.warn('Failed to send saved data to iframe:', e);
    }
  }

  // ==================== IFRAME MESSAGE HANDLER ====================

  async function handleIframeMessage(event) {
    const data = event.data;
    if (!data || !data.type) return;

    switch (data.type) {
      case 'SCROLL_UPDATE':
        if (currentBookPath) {
          currentScrollPercent = data.scrollPercent || 0;
          await DB.saveProgress(currentBookPath, {
            scrollPercent: data.scrollPercent,
            scrollTop: data.scrollTop,
            lastReadAt: Date.now(),
          });
          // Update progress display
          const progressEl = document.getElementById('reader-progress');
          if (progressEl) {
            progressEl.textContent = Math.round(data.scrollPercent) + '%';
            progressEl.style.setProperty('--progress', data.scrollPercent + '%');
          }
        }
        break;

      case 'HIGHLIGHT_CREATED':
        if (currentBookPath) {
          const book = BOOKS.find((b) => b.path === currentBookPath);
          await DB.addHighlight({
            bookPath: currentBookPath,
            bookTitle: book ? book.title : '',
            text: data.text,
            color: data.color || currentHighlightColor,
            elementSelector: data.elementSelector || '',
          });
        }
        break;

      case 'COMMENT_CREATED':
        if (currentBookPath) {
          const book2 = BOOKS.find((b) => b.path === currentBookPath);
          await DB.addComment({
            bookPath: currentBookPath,
            bookTitle: book2 ? book2.title : '',
            text: data.text,
            elementSelector: data.elementSelector || '',
          });
        }
        break;

      case 'READING_COMPLETE':
        if (currentBookPath) {
          await DB.markCompleted(currentBookPath);
          showCelebration();
        }
        break;

      case 'HIGHLIGHT_REMOVED':
        if (currentBookPath && data.text) {
          // Find and delete the highlight from DB by matching text + bookPath
          const allHighlights = await DB.getHighlights(currentBookPath);
          const match = allHighlights.find((h) => h.text === data.text);
          if (match) {
            await DB.deleteHighlight(match.id);
          }
          showToast('\u062A\u0645 \u0625\u0632\u0627\u0644\u0629 \u0627\u0644\u062A\u0638\u0644\u064A\u0644');
        }
        break;

      case 'SCROLL_DIRECTION':
        {
          const rh = document.querySelector('.reader-header');
          const rp = document.querySelector('.reader-progress-container');
          const bf = document.getElementById('book-frame');
          if (data.direction === 'down') {
            if (rh) rh.classList.add('reader-hidden');
            if (rp) rp.classList.add('reader-hidden');
            if (bf) bf.classList.add('immersive');
          } else {
            if (rh) rh.classList.remove('reader-hidden');
            if (rp) rp.classList.remove('reader-hidden');
            if (bf) bf.classList.remove('immersive');
          }
        }
        break;

      case 'CONTENT_LOADED':
        if (data.title) {
          const readerTitle = document.getElementById('reader-title');
          if (readerTitle) readerTitle.textContent = data.title;
        }
        break;
    }
  }

  // ==================== READER CONTROLS ====================

  async function addBookmarkAtCurrentPosition() {
    if (!currentBookPath) return;

    const book = BOOKS.find((b) => b.path === currentBookPath);
    await DB.addBookmark({
      bookPath: currentBookPath,
      bookTitle: book ? book.title : '',
      scrollPercent: currentScrollPercent,
      note: '',
    });

    // Visual feedback
    const btn = document.getElementById('btn-bookmark');
    if (btn) {
      btn.classList.add('bookmarked');
      setTimeout(() => btn.classList.remove('bookmarked'), 1500);
    }

    showToast('\u062A\u0645 \u062D\u0641\u0638 \u0627\u0644\u0639\u0644\u0627\u0645\u0629');
  }

  function toggleHighlightMode() {
    highlightModeActive = !highlightModeActive;

    const btn = document.getElementById('btn-highlight-mode');
    if (btn) {
      btn.classList.toggle('active', highlightModeActive);
    }

    const frame = document.getElementById('book-frame');
    if (frame && frame.contentWindow) {
      try {
        frame.contentWindow.postMessage({
          type: 'TOGGLE_HIGHLIGHT_MODE',
          active: highlightModeActive,
          color: currentHighlightColor,
        }, '*');
      } catch (e) { /* cross-origin */ }
    }
  }

  function toggleFontPanel() {
    let panel = document.getElementById('font-settings-panel');

    if (panel) {
      // Toggle visibility
      const isVisible = panel.classList.contains('visible');
      panel.classList.toggle('visible', !isVisible);
      return;
    }

    // Create panel
    panel = document.createElement('div');
    panel.id = 'font-settings-panel';
    panel.className = 'font-panel visible';
    panel.innerHTML = `
      <div class="font-panel-header">
        <span>\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u062E\u0637</span>
        <button class="font-panel-close" onclick="document.getElementById('font-settings-panel').classList.remove('visible')">\u2715</button>
      </div>
      <div class="font-panel-section">
        <label>\u062D\u062C\u0645 \u0627\u0644\u062E\u0637: <span id="font-size-value">${currentFontSize}px</span></label>
        <input type="range" id="font-size-slider" min="14" max="24" value="${currentFontSize}" step="1">
      </div>
      <div class="font-panel-section">
        <label>\u0646\u0648\u0639 \u0627\u0644\u062E\u0637</label>
        <div class="font-family-buttons">
          <button class="font-btn ${currentFontFamily === 'Tajawal' ? 'active' : ''}" data-font="Tajawal" style="font-family:Tajawal">Tajawal</button>
          <button class="font-btn ${currentFontFamily === 'Amiri' ? 'active' : ''}" data-font="Amiri" style="font-family:Amiri">\u0623\u0645\u064A\u0631\u064A</button>
          <button class="font-btn ${currentFontFamily === 'Noto Naskh Arabic' ? 'active' : ''}" data-font="Noto Naskh Arabic" style="font-family:'Noto Naskh Arabic'">\u0646\u0648\u062A\u0648 \u0646\u0633\u062E</button>
        </div>
      </div>
      <div class="font-panel-section">
        <label>\u062A\u0643\u0628\u064A\u0631 / \u062A\u0635\u063A\u064A\u0631</label>
        <div class="zoom-controls">
          <button class="zoom-btn" id="zoom-out">-</button>
          <span id="zoom-value">${Math.round(currentZoom * 100)}%</span>
          <button class="zoom-btn" id="zoom-in">+</button>
        </div>
      </div>
    `;

    document.getElementById('view-reader').appendChild(panel);

    // Font size slider
    const slider = panel.querySelector('#font-size-slider');
    slider.addEventListener('input', (e) => {
      currentFontSize = parseInt(e.target.value);
      panel.querySelector('#font-size-value').textContent = currentFontSize + 'px';
      DB.setSetting('fontSize', currentFontSize);
      sendFontToIframe();
    });

    // Font family buttons
    panel.querySelectorAll('.font-btn').forEach((btn) => {
      btn.addEventListener('click', (e) => {
        currentFontFamily = e.target.getAttribute('data-font');
        panel.querySelectorAll('.font-btn').forEach((b) => b.classList.remove('active'));
        e.target.classList.add('active');
        DB.setSetting('fontFamily', currentFontFamily);
        applyFontToBody();
        sendFontToIframe();
      });
    });

    // Zoom controls
    panel.querySelector('#zoom-out').addEventListener('click', () => {
      currentZoom = Math.max(0.8, currentZoom - 0.1);
      updateZoom();
    });
    panel.querySelector('#zoom-in').addEventListener('click', () => {
      currentZoom = Math.min(1.5, currentZoom + 0.1);
      updateZoom();
    });
  }

  function sendFontToIframe() {
    const frame = document.getElementById('book-frame');
    if (frame && frame.contentWindow) {
      try {
        frame.contentWindow.postMessage({
          type: 'SET_FONT_SIZE',
          size: currentFontSize,
        }, '*');
        frame.contentWindow.postMessage({
          type: 'SET_FONT_FAMILY',
          family: currentFontFamily,
        }, '*');
      } catch (e) { /* cross-origin */ }
    }
  }

  function updateZoom() {
    const zoomValue = document.getElementById('zoom-value');
    if (zoomValue) zoomValue.textContent = Math.round(currentZoom * 100) + '%';

    DB.setSetting('zoom', currentZoom);

    const frame = document.getElementById('book-frame');
    if (frame && frame.contentWindow) {
      try {
        frame.contentWindow.postMessage({
          type: 'SET_ZOOM',
          zoom: currentZoom,
        }, '*');
      } catch (e) { /* cross-origin */ }
    }
  }

  // ==================== TABLE OF CONTENTS ====================

  function showTableOfContents() {
    const frame = document.getElementById('book-frame');
    if (!frame) return;

    // Remove existing TOC panel
    const existing = document.getElementById('toc-panel');
    if (existing) {
      existing.remove();
      return;
    }

    let headings = [];
    try {
      const doc = frame.contentDocument || frame.contentWindow.document;
      const els = doc.querySelectorAll('h1, h2, h3');
      els.forEach((el, idx) => {
        const text = el.textContent.trim();
        if (text && text.length > 1) {
          headings.push({
            text,
            tag: el.tagName.toLowerCase(),
            index: idx,
          });
        }
      });
    } catch (e) {
      console.warn('Cannot access iframe headings:', e);
      return;
    }

    if (headings.length === 0) {
      showToast('\u0644\u0627 \u064A\u0648\u062C\u062F \u0641\u0647\u0631\u0633');
      return;
    }

    // Build TOC panel
    const panel = document.createElement('div');
    panel.id = 'toc-panel';
    panel.className = 'toc-panel';
    panel.innerHTML = `
      <div class="toc-backdrop"></div>
      <div class="toc-content">
        <div class="toc-header">
          <h3>\u0627\u0644\u0641\u0647\u0631\u0633</h3>
          <button class="toc-close">\u2715</button>
        </div>
        <div class="toc-list">
          ${headings.map((h, i) => `
            <button class="toc-item toc-${h.tag}" data-heading-index="${h.index}">
              ${h.text}
            </button>
          `).join('')}
        </div>
      </div>
    `;

    document.getElementById('view-reader').appendChild(panel);

    // Animate in
    requestAnimationFrame(() => panel.classList.add('visible'));

    // Close handlers
    panel.querySelector('.toc-backdrop').addEventListener('click', () => {
      panel.classList.remove('visible');
      setTimeout(() => panel.remove(), 300);
    });
    panel.querySelector('.toc-close').addEventListener('click', () => {
      panel.classList.remove('visible');
      setTimeout(() => panel.remove(), 300);
    });

    // Heading click handlers
    panel.querySelectorAll('.toc-item').forEach((item) => {
      item.addEventListener('click', () => {
        const idx = parseInt(item.getAttribute('data-heading-index'));
        try {
          const doc = frame.contentDocument || frame.contentWindow.document;
          const allHeadings = doc.querySelectorAll('h1, h2, h3');
          if (allHeadings[idx]) {
            allHeadings[idx].scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        } catch (e) { /* ignore */ }
        panel.classList.remove('visible');
        setTimeout(() => panel.remove(), 300);
      });
    });
  }

  // ==================== READING TIMER ====================

  function startReadingTimer() {
    readingTimerStart = Date.now();
    // Also update reading time in the book's progress every minute
    readingTimerInterval = setInterval(async () => {
      if (currentBookPath && readingTimerStart) {
        const elapsedMs = Date.now() - readingTimerStart;
        await DB.saveProgress(currentBookPath, {
          totalReadTimeMs: elapsedMs,
        });
      }
    }, 60000); // every minute
  }

  function stopReadingTimer() {
    if (readingTimerStart) {
      const elapsedMs = Date.now() - readingTimerStart;
      const minutes = Math.max(1, Math.round(elapsedMs / 60000));
      DB.logReadingTime(minutes);
      readingTimerStart = null;
    }
    if (readingTimerInterval) {
      clearInterval(readingTimerInterval);
      readingTimerInterval = null;
    }
  }

  // ==================== CELEBRATION ====================

  function showCelebration() {
    const overlay = document.createElement('div');
    overlay.className = 'celebration-overlay';
    overlay.innerHTML = `
      <div class="celebration-content">
        <div class="celebration-emoji">\uD83C\uDF89</div>
        <h2>\u0645\u0628\u0631\u0648\u0643!</h2>
        <p>\u0623\u0643\u0645\u0644\u062A \u0642\u0631\u0627\u0621\u0629 \u0627\u0644\u0643\u062A\u0627\u0628</p>
        <button class="celebration-btn" onclick="this.closest('.celebration-overlay').remove()">\u0645\u0645\u062A\u0627\u0632!</button>
      </div>
    `;
    document.body.appendChild(overlay);
    setTimeout(() => overlay.classList.add('visible'), 10);
  }

  // ==================== TOAST ====================

  function showToast(message) {
    let toast = document.getElementById('app-toast');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'app-toast';
      toast.className = 'app-toast';
      document.body.appendChild(toast);
    }
    toast.textContent = message;
    toast.classList.add('visible');
    setTimeout(() => toast.classList.remove('visible'), 2000);
  }

  // ==================== DASHBOARD VIEW ====================

  async function renderDashboard() {
    const dashSection = document.getElementById('view-dashboard');
    if (!dashSection) return;

    const allProgress = await DB.getAllProgress();
    const completed = allProgress.filter((p) => p.isCompleted);
    const inProgress = allProgress.filter((p) => !p.isCompleted && p.scrollPercent > 0);
    const streak = await DB.getStreak();

    // Calculate best streak
    let bestStreak = streak;
    let tempStreak = 0;
    const today = new Date();
    for (let i = 0; i < 365; i++) {
      const checkDate = new Date(today);
      checkDate.setDate(today.getDate() - i);
      const dateKey = formatDateKey(checkDate);
      const stats = await DB.getDailyStats(dateKey);
      if (stats && (stats.booksOpened.length > 0 || stats.minutesRead > 0)) {
        tempStreak++;
        if (tempStreak > bestStreak) bestStreak = tempStreak;
      } else {
        tempStreak = 0;
      }
    }

    // Total reading time
    let totalMinutes = 0;
    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
    const startKey = formatDateKey(thirtyDaysAgo);
    const endKey = formatDateKey(today);
    const statsRange = await DB.getStatsRange(startKey, endKey);
    statsRange.forEach((s) => { totalMinutes += s.minutesRead || 0; });

    const totalHours = Math.floor(totalMinutes / 60);
    const remainingMins = totalMinutes % 60;
    const avgPerDay = statsRange.length > 0 ? Math.round(totalMinutes / 30) : 0;

    // Calendar dots for last 30 days
    let calendarHtml = '<div class="calendar-dots">';
    for (let i = 29; i >= 0; i--) {
      const d = new Date(today);
      d.setDate(today.getDate() - i);
      const dKey = formatDateKey(d);
      const dayStat = statsRange.find((s) => s.date === dKey);
      const active = dayStat && (dayStat.booksOpened.length > 0 || dayStat.minutesRead > 0);
      const dayLabel = d.getDate();
      calendarHtml += `<div class="calendar-dot ${active ? 'active' : ''}" title="${dKey}"><span>${dayLabel}</span></div>`;
    }
    calendarHtml += '</div>';

    // Category breakdown
    const catCounts = {};
    CATEGORIES.forEach((c) => { catCounts[c.id] = { total: 0, read: 0 }; });
    BOOKS.forEach((b) => {
      catCounts[b.category].total++;
      const p = allProgress.find((pr) => pr.bookPath === b.path);
      if (p && p.isCompleted) catCounts[b.category].read++;
    });

    let catBarsHtml = '';
    CATEGORIES.forEach((cat) => {
      const c = catCounts[cat.id];
      const pct = c.total > 0 ? Math.round((c.read / c.total) * 100) : 0;
      catBarsHtml += `
        <div class="cat-bar-row">
          <span class="cat-bar-label">${cat.icon} ${cat.ar}</span>
          <div class="cat-bar-track">
            <div class="cat-bar-fill" style="width:${pct}%"></div>
          </div>
          <span class="cat-bar-count">${c.read}/${c.total}</span>
        </div>
      `;
    });

    // Recent activity
    const recentBooks = allProgress
      .filter((p) => p.lastReadAt)
      .sort((a, b) => b.lastReadAt - a.lastReadAt)
      .slice(0, 5);

    let recentHtml = '';
    recentBooks.forEach((p) => {
      const book = BOOKS.find((b) => b.path === p.bookPath);
      if (!book) return;
      const date = new Date(p.lastReadAt);
      const dateStr = date.toLocaleDateString('ar-SA', { month: 'short', day: 'numeric' });
      recentHtml += `
        <div class="recent-item" onclick="App.openBook('${book.path}')">
          <span class="recent-emoji">${book.emoji}</span>
          <div class="recent-info">
            <span class="recent-title">${book.title}</span>
            <span class="recent-date">${dateStr}</span>
          </div>
          <span class="recent-pct">${Math.round(p.scrollPercent)}%</span>
        </div>
      `;
    });

    // Mind Map: group by author
    const authorGroups = {};
    BOOKS.forEach((b) => {
      if (!authorGroups[b.author]) {
        authorGroups[b.author] = { authorEn: b.authorEn, books: [] };
      }
      authorGroups[b.author].books.push(b);
    });

    // Only show authors with 2+ books for the mind map
    const multiAuthors = Object.entries(authorGroups).filter(([, g]) => g.books.length >= 2);
    let mindMapHtml = '';
    if (multiAuthors.length > 0) {
      mindMapHtml += '<div class="mind-map">';
      multiAuthors.forEach(([authorAr, group]) => {
        const authorColor = group.books[0].color;
        mindMapHtml += `
          <div class="mind-map-cluster">
            <div class="mind-map-center" style="--cluster-color: var(--color-${authorColor}, #e94560)">
              <span class="mind-map-author">${authorAr}</span>
              <span class="mind-map-author-en">${group.authorEn}</span>
              <span class="mind-map-count">${group.books.length} \u0643\u062A\u0628</span>
            </div>
            <div class="mind-map-books">
        `;
        group.books.forEach((book, idx) => {
          const angle = (360 / group.books.length) * idx;
          mindMapHtml += `
            <div class="mind-map-book" style="--angle:${angle}deg; --book-color: var(--color-${book.color}, #e94560)" onclick="App.openBook('${book.path}')">
              <div class="mind-map-line"></div>
              <span class="mind-map-book-emoji">${book.emoji}</span>
              <span class="mind-map-book-title">${book.title}</span>
            </div>
          `;
        });
        mindMapHtml += `</div></div>`;
      });
      mindMapHtml += '</div>';
    }

    dashSection.innerHTML = `
      <div class="dashboard-content">
        <h2 class="dash-title">\uD83D\uDCCA \u0627\u0644\u0625\u062D\u0635\u0627\u0626\u064A\u0627\u062A</h2>

        <div class="streak-section" id="streak-section">
          <div class="streak-main">
            <span class="streak-number">${streak}</span>
            <span class="streak-fire">\uD83D\uDD25</span>
          </div>
          <p class="streak-label">\u0633\u0644\u0633\u0644\u0629 \u0627\u0644\u0642\u0631\u0627\u0621\u0629</p>
          <p class="streak-best">\u0623\u0641\u0636\u0644 \u0633\u0644\u0633\u0644\u0629: ${bestStreak} \u064A\u0648\u0645</p>
          ${calendarHtml}
        </div>

        <div class="stats-grid" id="stats-section">
          <div class="stat-card">
            <span class="stat-value">${completed.length}</span>
            <span class="stat-label">\u0643\u062A\u0628 \u0645\u0643\u062A\u0645\u0644\u0629</span>
          </div>
          <div class="stat-card">
            <span class="stat-value">${inProgress.length}</span>
            <span class="stat-label">\u0642\u064A\u062F \u0627\u0644\u0642\u0631\u0627\u0621\u0629</span>
          </div>
          <div class="stat-card">
            <span class="stat-value">${totalHours > 0 ? totalHours + '\u0633' : ''} ${remainingMins}\u062F</span>
            <span class="stat-label">\u0648\u0642\u062A \u0627\u0644\u0642\u0631\u0627\u0621\u0629</span>
          </div>
          <div class="stat-card">
            <span class="stat-value">${avgPerDay} \u062F</span>
            <span class="stat-label">\u0645\u0639\u062F\u0644 \u064A\u0648\u0645\u064A</span>
          </div>
        </div>

        <div class="dash-section" id="category-chart">
          <h3 class="dash-section-title">\u0627\u0644\u062A\u0635\u0646\u064A\u0641\u0627\u062A</h3>
          ${catBarsHtml}
        </div>

        ${recentBooks.length > 0 ? `
        <div class="dash-section">
          <h3 class="dash-section-title">\u0627\u0644\u0646\u0634\u0627\u0637 \u0627\u0644\u0623\u062E\u064A\u0631</h3>
          <div class="recent-list">${recentHtml}</div>
        </div>
        ` : ''}

        ${mindMapHtml ? `
        <div class="dash-section" id="mind-map-section">
          <h3 class="dash-section-title">\u062E\u0631\u064A\u0637\u0629 \u0627\u0644\u0645\u0624\u0644\u0641\u064A\u0646</h3>
          ${mindMapHtml}
        </div>
        ` : ''}
      </div>
    `;
  }

  // ==================== QUOTES VIEW ====================

  async function renderQuotes() {
    const quotesContent = document.getElementById('quotes-content') || document.getElementById('view-quotes');
    if (!quotesContent) return;

    // Get all data
    const highlights = await DB.getHighlights();
    const comments = await DB.getComments();
    const bookmarks = await DB.getBookmarks();

    // Determine which sub-tab is active (default: highlights)
    let activeTab = quotesContent.getAttribute('data-active-tab') || 'highlights';

    let tabsHtml = `
      <div class="quotes-tabs" id="quotes-tabs">
        <button class="quotes-tab ${activeTab === 'highlights' ? 'active' : ''}" data-qtab="highlights">\u0627\u0642\u062A\u0628\u0627\u0633\u0627\u062A</button>
        <button class="quotes-tab ${activeTab === 'comments' ? 'active' : ''}" data-qtab="comments">\u062A\u0639\u0644\u064A\u0642\u0627\u062A</button>
        <button class="quotes-tab ${activeTab === 'bookmarks' ? 'active' : ''}" data-qtab="bookmarks">\u0639\u0644\u0627\u0645\u0627\u062A</button>
      </div>
    `;

    let contentHtml = '';

    if (activeTab === 'highlights') {
      contentHtml = renderHighlightsList(highlights);
    } else if (activeTab === 'comments') {
      contentHtml = renderCommentsList(comments);
    } else if (activeTab === 'bookmarks') {
      contentHtml = renderBookmarksList(bookmarks);
    }

    // Determine the target element
    const targetEl = document.getElementById('view-quotes');
    if (targetEl) {
      targetEl.innerHTML = `
        <div class="quotes-view-content">
          <h2 class="quotes-title">\uD83D\uDCDD \u0645\u0644\u0627\u062D\u0638\u0627\u062A\u064A</h2>
          ${tabsHtml}
          <div class="quotes-list" id="quotes-list">${contentHtml}</div>
        </div>
      `;
      targetEl.setAttribute('data-active-tab', activeTab);

      // Tab click handlers
      targetEl.querySelectorAll('.quotes-tab').forEach((tab) => {
        tab.addEventListener('click', (e) => {
          targetEl.setAttribute('data-active-tab', e.target.getAttribute('data-qtab'));
          renderQuotes();
        });
      });

      // Delete handlers
      targetEl.querySelectorAll('[data-delete-highlight]').forEach((btn) => {
        btn.addEventListener('click', async (e) => {
          e.stopPropagation();
          const id = parseInt(btn.getAttribute('data-delete-highlight'));
          await DB.deleteHighlight(id);
          renderQuotes();
        });
      });

      targetEl.querySelectorAll('[data-delete-comment]').forEach((btn) => {
        btn.addEventListener('click', async (e) => {
          e.stopPropagation();
          const id = parseInt(btn.getAttribute('data-delete-comment'));
          await DB.deleteComment(id);
          renderQuotes();
        });
      });

      targetEl.querySelectorAll('[data-delete-bookmark]').forEach((btn) => {
        btn.addEventListener('click', async (e) => {
          e.stopPropagation();
          const id = parseInt(btn.getAttribute('data-delete-bookmark'));
          await DB.deleteBookmark(id);
          renderQuotes();
        });
      });

      // Share handlers
      targetEl.querySelectorAll('[data-share-text]').forEach((btn) => {
        btn.addEventListener('click', async (e) => {
          e.stopPropagation();
          const text = btn.getAttribute('data-share-text');
          await shareText(text);
        });
      });
    }
  }

  function renderHighlightsList(highlights) {
    if (highlights.length === 0) {
      return `<div class="empty-state"><p>\u0644\u0627 \u062A\u0648\u062C\u062F \u0627\u0642\u062A\u0628\u0627\u0633\u0627\u062A \u0628\u0639\u062F</p></div>`;
    }

    // Group by book
    const grouped = {};
    highlights.forEach((h) => {
      if (!grouped[h.bookPath]) grouped[h.bookPath] = [];
      grouped[h.bookPath].push(h);
    });

    let html = '';
    Object.entries(grouped).forEach(([bookPath, items]) => {
      const book = BOOKS.find((b) => b.path === bookPath);
      const bookTitle = book ? book.title : items[0].bookTitle || bookPath;
      html += `<div class="quotes-group"><h4 class="quotes-group-title">${bookTitle}</h4>`;
      items.sort((a, b) => b.createdAt - a.createdAt).forEach((h) => {
        const date = new Date(h.createdAt).toLocaleDateString('ar-SA', { month: 'short', day: 'numeric' });
        html += `
          <div class="quote-item highlight-${h.color || 'yellow'}">
            <p class="quote-text">${escapeHtml(h.text)}</p>
            <div class="quote-meta">
              <span class="quote-date">${date}</span>
              <div class="quote-actions">
                <button class="quote-action-btn" data-share-text="${escapeAttr(h.text)}">\u0645\u0634\u0627\u0631\u0643\u0629</button>
                <button class="quote-action-btn delete" data-delete-highlight="${h.id}">\u062D\u0630\u0641</button>
              </div>
            </div>
          </div>
        `;
      });
      html += '</div>';
    });
    return html;
  }

  function renderCommentsList(comments) {
    if (comments.length === 0) {
      return `<div class="empty-state"><p>\u0644\u0627 \u062A\u0648\u062C\u062F \u062A\u0639\u0644\u064A\u0642\u0627\u062A \u0628\u0639\u062F</p></div>`;
    }

    const grouped = {};
    comments.forEach((c) => {
      if (!grouped[c.bookPath]) grouped[c.bookPath] = [];
      grouped[c.bookPath].push(c);
    });

    let html = '';
    Object.entries(grouped).forEach(([bookPath, items]) => {
      const book = BOOKS.find((b) => b.path === bookPath);
      const bookTitle = book ? book.title : items[0].bookTitle || bookPath;
      html += `<div class="quotes-group"><h4 class="quotes-group-title">${bookTitle}</h4>`;
      items.sort((a, b) => b.createdAt - a.createdAt).forEach((c) => {
        const date = new Date(c.createdAt).toLocaleDateString('ar-SA', { month: 'short', day: 'numeric' });
        html += `
          <div class="quote-item comment-item">
            <p class="quote-text">${escapeHtml(c.text)}</p>
            <div class="quote-meta">
              <span class="quote-date">${date}</span>
              <button class="quote-action-btn delete" data-delete-comment="${c.id}">\u062D\u0630\u0641</button>
            </div>
          </div>
        `;
      });
      html += '</div>';
    });
    return html;
  }

  function renderBookmarksList(bookmarks) {
    if (bookmarks.length === 0) {
      return `<div class="empty-state"><p>\u0644\u0627 \u062A\u0648\u062C\u062F \u0639\u0644\u0627\u0645\u0627\u062A \u0628\u0639\u062F</p></div>`;
    }

    const grouped = {};
    bookmarks.forEach((bm) => {
      if (!grouped[bm.bookPath]) grouped[bm.bookPath] = [];
      grouped[bm.bookPath].push(bm);
    });

    let html = '';
    Object.entries(grouped).forEach(([bookPath, items]) => {
      const book = BOOKS.find((b) => b.path === bookPath);
      const bookTitle = book ? book.title : items[0].bookTitle || bookPath;
      html += `<div class="quotes-group"><h4 class="quotes-group-title">${bookTitle}</h4>`;
      items.sort((a, b) => b.createdAt - a.createdAt).forEach((bm) => {
        const date = new Date(bm.createdAt).toLocaleDateString('ar-SA', { month: 'short', day: 'numeric' });
        html += `
          <div class="quote-item bookmark-item" onclick="App.openBook('${bookPath}')">
            <p class="quote-text">\uD83D\uDD16 \u0639\u0646\u062F ${Math.round(bm.scrollPercent)}%${bm.note ? ' \u2014 ' + escapeHtml(bm.note) : ''}</p>
            <div class="quote-meta">
              <span class="quote-date">${date}</span>
              <button class="quote-action-btn delete" data-delete-bookmark="${bm.id}">\u062D\u0630\u0641</button>
            </div>
          </div>
        `;
      });
      html += '</div>';
    });
    return html;
  }

  async function shareText(text) {
    if (navigator.share) {
      try {
        await navigator.share({ text });
      } catch (e) {
        // User cancelled or share failed, fall back to clipboard
        copyToClipboard(text);
      }
    } else {
      copyToClipboard(text);
    }
  }

  function copyToClipboard(text) {
    if (navigator.clipboard) {
      navigator.clipboard.writeText(text).then(() => {
        showToast('\u062A\u0645 \u0627\u0644\u0646\u0633\u062E');
      });
    } else {
      // Fallback for older browsers / iOS Safari
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.opacity = '0';
      document.body.appendChild(ta);
      ta.focus();
      ta.select();
      try {
        document.execCommand('copy');
        showToast('\u062A\u0645 \u0627\u0644\u0646\u0633\u062E');
      } catch (e) {
        showToast('\u0641\u0634\u0644 \u0627\u0644\u0646\u0633\u062E');
      }
      document.body.removeChild(ta);
    }
  }

  // ==================== SETTINGS VIEW ====================

  async function renderSettings() {
    const settingsEl = document.getElementById('view-settings');
    if (!settingsEl) return;

    settingsEl.innerHTML = `
      <div class="settings-content" id="settings-content">
        <h2 class="settings-title">\u2699\uFE0F \u0627\u0644\u0625\u0639\u062F\u0627\u062F\u0627\u062A</h2>

        <div class="settings-section">
          <h3>\u0627\u0644\u0645\u0638\u0647\u0631</h3>
          <div class="theme-buttons">
            <button class="theme-btn ${currentTheme === 'dark' ? 'active' : ''}" data-theme="dark">
              <span class="theme-preview" style="background:#0f0f1a;color:#e0e0e0">\u0623</span>
              <span>\u062F\u0627\u0643\u0646</span>
            </button>
            <button class="theme-btn ${currentTheme === 'light' ? 'active' : ''}" data-theme="light">
              <span class="theme-preview" style="background:#f5f5f5;color:#2c2c2c">\u0623</span>
              <span>\u0641\u0627\u062A\u062D</span>
            </button>
            <button class="theme-btn ${currentTheme === 'sepia' ? 'active' : ''}" data-theme="sepia">
              <span class="theme-preview" style="background:#f4f1ea;color:#5c4b37">\u0623</span>
              <span>\u0628\u0646\u064A</span>
            </button>
          </div>
        </div>

        <div class="settings-section">
          <h3>\u062D\u062C\u0645 \u0627\u0644\u062E\u0637: <span id="settings-font-size-val">${currentFontSize}px</span></h3>
          <input type="range" id="settings-font-slider" class="settings-slider" min="14" max="24" value="${currentFontSize}" step="1">
        </div>

        <div class="settings-section">
          <h3>\u0646\u0648\u0639 \u0627\u0644\u062E\u0637</h3>
          <div class="font-family-buttons">
            <button class="font-btn ${currentFontFamily === 'Tajawal' ? 'active' : ''}" data-sfont="Tajawal" style="font-family:Tajawal">Tajawal</button>
            <button class="font-btn ${currentFontFamily === 'Amiri' ? 'active' : ''}" data-sfont="Amiri" style="font-family:Amiri">\u0623\u0645\u064A\u0631\u064A</button>
            <button class="font-btn ${currentFontFamily === 'Noto Naskh Arabic' ? 'active' : ''}" data-sfont="Noto Naskh Arabic" style="font-family:'Noto Naskh Arabic'">\u0646\u0648\u062A\u0648 \u0646\u0633\u062E</button>
          </div>
        </div>

        <div class="settings-section">
          <h3>\u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A</h3>
          <div class="data-buttons">
            <button class="data-btn" id="btn-export">\uD83D\uDCE4 \u062A\u0635\u062F\u064A\u0631 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A</button>
            <label class="data-btn" id="btn-import-label">
              \uD83D\uDCE5 \u0627\u0633\u062A\u064A\u0631\u0627\u062F
              <input type="file" id="btn-import" accept=".json" style="display:none">
            </label>
            <button class="data-btn danger" id="btn-clear">\uD83D\uDDD1\uFE0F \u0645\u0633\u062D \u0627\u0644\u0643\u0644</button>
          </div>
        </div>

        <div class="settings-section about-section">
          <h3>\u062D\u0648\u0644 \u0627\u0644\u062A\u0637\u0628\u064A\u0642</h3>
          <p>\u0645\u0643\u062A\u0628\u062A\u064A \u0627\u0644\u0634\u062E\u0635\u064A\u0629</p>
          <p class="version">\u0627\u0644\u0625\u0635\u062F\u0627\u0631 1.0.0</p>
        </div>
      </div>
    `;

    // Theme buttons
    settingsEl.querySelectorAll('.theme-btn').forEach((btn) => {
      btn.addEventListener('click', () => {
        const theme = btn.getAttribute('data-theme');
        applyTheme(theme);
        settingsEl.querySelectorAll('.theme-btn').forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // Font size slider
    const fontSlider = settingsEl.querySelector('#settings-font-slider');
    if (fontSlider) {
      fontSlider.addEventListener('input', (e) => {
        currentFontSize = parseInt(e.target.value);
        settingsEl.querySelector('#settings-font-size-val').textContent = currentFontSize + 'px';
        DB.setSetting('fontSize', currentFontSize);
        document.body.style.fontSize = currentFontSize + 'px';
      });
    }

    // Font family
    settingsEl.querySelectorAll('[data-sfont]').forEach((btn) => {
      btn.addEventListener('click', () => {
        currentFontFamily = btn.getAttribute('data-sfont');
        settingsEl.querySelectorAll('[data-sfont]').forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');
        DB.setSetting('fontFamily', currentFontFamily);
        applyFontToBody();
      });
    });

    // Export
    const btnExport = settingsEl.querySelector('#btn-export');
    if (btnExport) {
      btnExport.addEventListener('click', async () => {
        const data = await DB.exportAll();
        if (data) {
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'maktabati-backup-' + formatDateKey(new Date()) + '.json';
          a.click();
          URL.revokeObjectURL(url);
          showToast('\u062A\u0645 \u062A\u0635\u062F\u064A\u0631 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A');
        }
      });
    }

    // Import
    const btnImport = settingsEl.querySelector('#btn-import');
    if (btnImport) {
      btnImport.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        try {
          const text = await file.text();
          const data = JSON.parse(text);
          await DB.importAll(data);
          showToast('\u062A\u0645 \u0627\u0633\u062A\u064A\u0631\u0627\u062F \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A');
          renderLibrary();
        } catch (err) {
          showToast('\u0641\u0634\u0644 \u0627\u0644\u0627\u0633\u062A\u064A\u0631\u0627\u062F: ' + err.message);
        }
      });
    }

    // Clear all
    const btnClear = settingsEl.querySelector('#btn-clear');
    if (btnClear) {
      btnClear.addEventListener('click', async () => {
        if (confirm('\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u0645\u0633\u062D \u062C\u0645\u064A\u0639 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A\u061F \u0644\u0627 \u064A\u0645\u0643\u0646 \u0627\u0644\u062A\u0631\u0627\u062C\u0639 \u0639\u0646 \u0647\u0630\u0627 \u0627\u0644\u0625\u062C\u0631\u0627\u0621.')) {
          await DB.clearAll();
          showToast('\u062A\u0645 \u0645\u0633\u062D \u062C\u0645\u064A\u0639 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A');
          renderLibrary();
        }
      });
    }
  }

  // ==================== ACTIONS VIEW ====================

  async function renderActions() {
    const actionsEl = document.getElementById('view-actions');
    if (!actionsEl) return;

    // Load all action states from settings
    const actionStates = {};
    for (const book of BOOKS) {
      const actions = BOOK_ACTIONS[book.id];
      if (!actions) continue;
      for (let i = 0; i < actions.length; i++) {
        const key = 'action:' + book.id + ':' + i;
        const val = await DB.getSetting(key);
        actionStates[key] = !!val;
      }
    }

    // Calculate stats
    let totalActions = 0;
    let completedActions = 0;
    const bookStats = {};

    BOOKS.forEach((book) => {
      const actions = BOOK_ACTIONS[book.id];
      if (!actions) return;
      let done = 0;
      actions.forEach((_, i) => {
        totalActions++;
        const key = 'action:' + book.id + ':' + i;
        if (actionStates[key]) {
          completedActions++;
          done++;
        }
      });
      bookStats[book.id] = { total: actions.length, done };
    });

    const overallPct = totalActions > 0 ? Math.round((completedActions / totalActions) * 100) : 0;

    // Build HTML
    let html = `
      <div class="actions-content">
        <div class="actions-overall">
          <div class="actions-overall-ring">
            <svg viewBox="0 0 100 100" width="80" height="80">
              <circle cx="50" cy="50" r="42" fill="none" stroke="var(--border)" stroke-width="8"/>
              <circle cx="50" cy="50" r="42" fill="none" stroke="var(--accent)" stroke-width="8"
                stroke-linecap="round" stroke-dasharray="${2 * Math.PI * 42}"
                stroke-dashoffset="${2 * Math.PI * 42 * (1 - overallPct / 100)}"
                transform="rotate(-90 50 50)"/>
            </svg>
            <span class="actions-overall-pct">${overallPct}%</span>
          </div>
          <div class="actions-overall-info">
            <span class="actions-overall-count">${completedActions} / ${totalActions}</span>
            <span class="actions-overall-label">\u0625\u062C\u0631\u0627\u0621 \u0645\u0643\u062A\u0645\u0644</span>
          </div>
        </div>
    `;

    // Group books by category
    const categoryOrder = ['productivity', 'finance', 'biography', 'pregnancy', 'fatherhood', 'selfmgmt', 'marriage'];
    categoryOrder.forEach((catId) => {
      const cat = CATEGORIES.find((c) => c.id === catId);
      const catBooks = BOOKS.filter((b) => b.category === catId && BOOK_ACTIONS[b.id]);
      if (catBooks.length === 0) return;

      html += `<div class="actions-category">
        <h3 class="actions-category-title">${cat.icon} ${cat.ar}</h3>`;

      catBooks.forEach((book) => {
        const stats = bookStats[book.id];
        const bookPct = stats.total > 0 ? Math.round((stats.done / stats.total) * 100) : 0;
        const isAllDone = stats.done === stats.total;

        html += `
        <div class="actions-book ${isAllDone ? 'all-done' : ''}">
          <div class="actions-book-header" data-toggle-book="${book.id}">
            <span class="actions-book-emoji">${book.emoji}</span>
            <div class="actions-book-info">
              <span class="actions-book-title">${book.title}</span>
              <div class="actions-book-progress">
                <div class="actions-book-bar">
                  <div class="actions-book-bar-fill" style="width:${bookPct}%"></div>
                </div>
                <span class="actions-book-pct">${stats.done}/${stats.total}</span>
              </div>
            </div>
            <span class="actions-book-chevron">\u276F</span>
          </div>
          <div class="actions-book-list" id="actions-list-${book.id}" style="display:none">`;

        const actions = BOOK_ACTIONS[book.id];
        actions.forEach((action, i) => {
          const key = 'action:' + book.id + ':' + i;
          const checked = actionStates[key];
          html += `
            <label class="action-item ${checked ? 'done' : ''}">
              <input type="checkbox" ${checked ? 'checked' : ''} data-action-key="${key}">
              <span class="action-check">${checked ? '\u2713' : ''}</span>
              <span class="action-text">${action}</span>
            </label>`;
        });

        html += `</div></div>`;
      });

      html += `</div>`;
    });

    html += `</div>`;

    actionsEl.innerHTML = `
      <div class="view-header">
        <h2>\u062E\u0637\u0629 \u0627\u0644\u062A\u0637\u0628\u064A\u0642</h2>
      </div>
      ${html}
    `;

    // Toggle book expand/collapse
    actionsEl.querySelectorAll('[data-toggle-book]').forEach((header) => {
      header.addEventListener('click', () => {
        const bookId = header.getAttribute('data-toggle-book');
        const list = document.getElementById('actions-list-' + bookId);
        const chevron = header.querySelector('.actions-book-chevron');
        if (list) {
          const isOpen = list.style.display !== 'none';
          list.style.display = isOpen ? 'none' : 'block';
          if (chevron) chevron.style.transform = isOpen ? '' : 'rotate(90deg)';
        }
      });
    });

    // Checkbox handlers
    actionsEl.querySelectorAll('input[data-action-key]').forEach((cb) => {
      cb.addEventListener('change', async (e) => {
        e.stopPropagation();
        const key = cb.getAttribute('data-action-key');
        const checked = cb.checked;
        await DB.setSetting(key, checked ? 1 : 0);

        // Sync to cloud
        if (window.CloudSync) {
          CloudSync.pushSetting(key, checked ? 1 : 0);
        }

        // Re-render to update stats
        renderActions();
      });
    });
  }

  // ==================== UTILITIES ====================

  function formatDateKey(date) {
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, '0');
    const d = String(date.getDate()).padStart(2, '0');
    return `${y}-${m}-${d}`;
  }

  function escapeHtml(str) {
    if (!str) return '';
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  function escapeAttr(str) {
    if (!str) return '';
    return str
      .replace(/&/g, '&amp;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');
  }

  // ==================== PUBLIC API ====================

  window.App = {
    init,
    openBook,
    closeBook,
    switchView,
    BOOKS,
    CATEGORIES,
  };

})();
